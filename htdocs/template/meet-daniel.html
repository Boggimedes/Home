<div class="outerpage" data-background-file="">
	<div class="header">
		<h1>Meet<br>Daniel Boggs</h1>
	</div>
	<div>
		<p>
			So you are looking for a developer?
		</p>
		<p>
			Here you can learn a little about Daniel Boggs.  A talented coder, freestyle underwater basketweaver, and all around nice guy.
		</p>
		<p>
			You can click and drag through the profile pages, or click a link in the table of contents below
		</p>
	</div>
	<div id="toc" class="linklist dintext">
		<ul>
			<p>
				Table of Contents:
			</p>
			<li onclick="gotoPage(2);">
				Resume
			</li>
			<li onclick="gotoPage(4);">
				Coding Projects
			</li>
			<li onclick="gotoPage(6);">
				Hobbies
			</li>
			<li onclick="gotoPage(7);">
				Family
			</li>
		</ul>
	</div>
	<div>
		<h3>User guide:</h3>
		<ul>
			<li>
				Drag the corners or sides,
			</li>
			<li>
				Click/Tap on the corners,
			</li>
			<li>
				Use Keyboard left/right arrows,
			</li>
			<li>
				Enter page number manually.
			</li>
			<li>
				Clicking the corners makes the page flip automatically.
			</li>
			<li>
				Dragging it lets you manually flip with page folding effect.
			</li>
		</ul>
	</div>
	<div class="footertext dintext">
		<p>
			Daniel Boggs / Portfolio / Resume
		</p>
	</div>
</div>

<div class="cover" data-background-file="">
	<div class="" style="margin:auto;width:65%">
		<svg id="word-cloud" class="word-cloud" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 462 693">
			<rect width="462" height="693" style="fill:rgb(248,248,252);"></rect>
		</svg>
	</div>
	<script type="text/javascript" src="js/word-cloud.js"></script>
</div>

<div class="page">
	<div class="page-container resume">
		<h1 style=''>Daniel Boggs</h1>
		<hr>
		<div class="row">
			<div class="col-xs-4">
				Tigard, OR 97224
			</div>
			<div class="col-xs-4">
				email: <a href="mailto:Boggimedes@gmail.com">Boggimedes@gmail.com</a>
			</div>
			<div class="col-xs-4">
				phone: 503-731-7167
			</div>
		</div>
		<h3 class="text-center">Summary</h3>
		<div>
			Someone who knew me well once described me as a problem solving and efficiency expert.  I excel at finding solutions; whether by contracting/collaborating with the proper resources, or using my own technical background and expertise to solve the issue first hand.  I have experience managing teams of up to 20, documenting and analyzing large scale business projects, and personally designing business automation to improve efficiency.  No matter the challenge, I face it head on without hesitation. 
		</div>
		<div class="row">
			<div class="col-xs-6">
				<h4>Technical Skills</h4>
				<strong>Advanced/Guru: </strong><span class="color-language">PHP, JavaScript, HTML5/CSS3, SQL, MySQL,</span> <span class="color-software">Windows XP/7/10, Excel, Access</span><br>
				<strong>Experienced: </strong><span class="color-library">AngularJS, jQuery, Bootstrap,</span> <span class="">REST,</span> <span class="color-software">Amazon Web Services, Linux, Office 365, PowerShell, Dynamics AX, SharePoint,</span> <span class="color-language">VBA, PostgreSQL,</span> <span class="color-library">Sugar CRM, CraftCMS,</span> <span class="color-software">Git, Sublime3, npm</span><br>
				<strong>Learning: </strong><span class="color-language">Java, NodeJS,</span> <span class="color-library">Struts2,</span> <span class="color-software">Tomcat</span>
			</div>
			<div class="col-xs-6">
				<h4>Non-Technical</h4>
				<p class="resume-paragraph">
					<strong>Leadership: </strong>My style of leadership is the ability to share a vision, to guide others without force toward that vision, and to understand people’s talents to help them reach their full potential. 
				</p>
				<p class="resume-paragraph">
					<strong>Collaboration: </strong>I work best in an environment that is highly collaborative and brings people together to create solutions that incorporate many perspectives.
				</p>
			</div>
		</div>
		<h3>Employment Experience Summary</h3>
		<div class="row">
			<div class="col-xs-6">
				<strong class="lead">Blue Star Sports</strong> <small>(contract)</small>
			</div>
			<div class="col-xs-6 text-right">
				June 2017 - Present
			</div>
		</div>
		<hr/>
		<div class="row">
			<div class="col-xs-1">
				June 2017 - Present
			</div>
			<div class="col-xs-2">
				<strong>Full Stack Developer</strong>
			</div>
			<div class="col-xs-9">
				<ul class="list-bullets">
					<li>
						Enhancement and bug fixes for established SaaS web application
					</li>
					<li>
						Jira ticketing with git change control
					</li>
					<li>
						<span class="color-software">Git,</span> <span class="color-language">PostgreSQL, PHP, JavaScript,</span> <span class="color-library">jQuery, Backbone, Knockout,</span> REST, <span class="color-language">HTML5/CSS3,</span> <span class="color-software">npm, Sublime3</span>
					</li>
				</ul>
			</div>
		</div>

		<div class="row">
			<div class="col-xs-6">
				<strong class="lead">InFocus Corporation</strong>
			</div>
			<div class="col-xs-6 text-right">
				May 2006 - June 2017
			</div>
		</div>
		<hr/>
		<div class="row">
			<div class="col-xs-1">
				2012 - June 2017
			</div>
			<div class="col-xs-2">
				<strong>Full Stack Developer</strong>
			</div>
			<div class="col-xs-9">
				<ul class="list-bullets">
					<li>
						Designed internal site to organize and document processes and systems
					</li>
					<li>
						Re-developed reporting tools for sales supplying up to date information to the field
					</li>
					<li>
						Re-designed and deployed new InFocus website with custom CMS system
					</li>
					<li>
						<span class="color-language">PHP, MySQL, SQL, HTML5/CSS3, JavaScript,</span> REST,<span color="color-library">SQL, jQuery, AngularJS, CraftCMS, Sugar CRM,</span> <span class="color-software">Dynamics AX, SharePoint, PowerShell</span>
					</li>
				</ul>
			</div>
		</div>

		<div class="row">
			<div class="col-xs-1">
				2009 - 2012
			</div>
			<div class="col-xs-2">
				<strong>Call Center Supervisor</strong>
			</div>
			<div class="col-xs-9">
				<ul class="list-bullets">
					<li>
						Took the company BBB rating from an F to an A
					</li>
					<li>
						Developed custom ticketing system
					</li>
					<li>
						Implemented Call Center coverage of internal level 1 &amp; 2 IT issues
					</li>
					<li>
						<span class="color-software">Dynamics AX, Access, Excel,</span> <span color="color-language">MySQL, VBA</span>
					</li>
				</ul>
			</div>
		</div>

		<div class="row">
			<div class="col-xs-1">
				2006 - 2009
			</div>
			<div class="col-xs-2">
				<strong>Call Center Lead</strong>
			</div>
			<div class="col-xs-9">
				<ul class="list-bullets">
					<li>
						Managed service issues for the large Pro-AV accounts
					</li>
					<li>
						Handled all customer escalations
					</li>
					<li>
						Organized the schedule to provide coverage based on call volume
					</li>
					<li>
						<span class="color-software">Dynamics AX, Excel,</span> <span color="color-language">MySQL, VBA</span>
					</li>
				</ul>
			</div>
		</div>
	</div>
</div>

<div class="page">
	<div class="page-container resume">
		<h3>Employment Experience Details</h3>
		<div class="row">
			<div class="col-xs-1">
				Jun'17 - present
			</div>
			<div class="col-xs-11">
				<div>
					<strong>Blue Star Sports: Full Stack Developer</strong> (Contractor)
				</div>
				<ul class="list-bullets">
					<li>
						Working on a large scale, multi-faceted SaaS product with a team of 9 other developers.  Daily tasks include bug-fixes and enhancement requests through JIRA. Used: <span class="color-software">Git,</span> <span class="color-language">PostgreSQL, PHP, JavaScript, HTML5/CSS3,</span> <span class="color-library">jQuery, Backbone, Knockout,</span> REST, <span class="color-software">npm, Sublime3</span>
					</li>
				</ul>
			</div>
		</div>
		<div class="row">
			<div class="col-xs-1">
			Nov'12 - Jun'17
			</div>
			<div class="col-xs-11">
			<div>
				<strong>InFocus Corporation: Full Stack Developer</strong>
			</div>
				<ul class="list-bullets">
					<li>
						Created new internal site for organization and documentation of processes and systems. Used: <span class="color-library">AngularJS</span>, <span class="color-language">HTML5/CSS3</span>, <span class="color-language">MySQL</span>,<span class="color-language"> SQL, PHP, </span><span class="color-library">CraftCMS</span>, <span class="color-software">PowerShell</span>
					</li>
					<li>
						Recently completed designing a partner order portal that will link to <span class="color-software">Dynamics AX</span> for order processing. This is highlighting <span class="color-library">AngularJS </span>to present price lists, product catalog, and manage a cart for checkout. <span class="color-language">SQL </span>stored procedures will be used to pull pricing and availability daily to provide up to date information to InFocus partners and resellers. Used: <span class="color-library">AngularJS</span>, <span class="color-language">HTML5/CSS3</span>, <span class="color-language">MySQL</span>,<span class="color-language"> SQL</span>
					</li>
					<li>
						Re-designed and deployed new InFocus website (www.infocus.com). Created a custom <span class="color-language">PHP </span>framework for an adaptive website (fully mobile compatible) including a content management system so the site can be maintained and updated by the marketing team. Used: <span class="color-language">PHP</span>, <span class="color-language">HTML5/CSS3S</span>, <span class="color-language">JavaScript, </span>and <span class="color-library">jQuery</span>.
					</li>
					<li>
						Completely redesigned the company database and customer registration system enabling live tracking of warranty obligation as well an external interface for customers to check warranty and registration status from the website. Data was moved from proprietary system to a universal MySQL database. Used: <span class="color-language">PHP</span>, <span class="color-language">MySQL</span>, <span class="color-language">HTML5/CSS3</span>, and <span class="color-language">JavaScript</span>.
					</li>
					<li>
						Developed internal employee website and partner website with secure SSL login and user system. Tools for order processing and status, internal help desk, knowledge base, and executive reporting. Used: <span class="color-language">PHP</span>, <span class="color-language">HTML/CSS</span>, <span class="color-language">JavaScript</span>, and<span class="color-language"> MySQL.</span>
					</li>
					<li>
						Re-developed reporting tools for sales supplying up to date information to the field. These tools automated pulling data from <span class="color-software">Dynamics AX </span>(using a complex set of stored procedures and queries), uploading to <span class="color-language">MySQL</span>, then output to <span class="color-language">HTML/CSS</span> on the internal site, as well as emailed out in spreadsheet form. Used: <span class="color-software">Dynamics AX, </span><span class="color-language">T-SQL</span>, <span class="color-language">MySQL</span>, <span class="color-language">HTML/CSS</span>, <span class="color-language">PHP</span>, <span class="color-library">jQuery</span>, and <span class="color-language">JavaScript</span>.
					</li>
					<li>
						Designed automated reporting for the Amazon web-store. Used: <span class="color-language">PHP </span>and <span class="color-language">MySQL</span>.
					</li>
					<li>
						Replaced a materials and funding request system with a custom tool build. Tool consisted of several parts. Front end external facing for the sales people to enter claims and requests. These requests would then be routed to the marketing team for approval or escalation. Used: <span class="color-language">PHP</span>, <span class="color-language">HTML/CSS</span>, <span class="color-language">JavaScript</span>, <span class="color-library">AngularJS</span>.
					</li>			
				</ul>
			</div>
		</div>
		<div class="row">
			<div class="col-xs-1">
				May'06 - Nov'12
			</div>
			<div class="col-xs-11">
			<div>
				<strong>InFocus Corporation: Call Center Supervisor</strong>
			</div>
			<ul class="list-bullets">
				<li>
					Designed a full call center CRM tool.  Agents had all product and procedure data no more than 2 clicks away.  Warranty status was checked automatically.  Used Fuzzy logic to locate alternate cases by the same customer. Used: <span class="color-software">Excel, Access,</span> <span color="color-language">VBA, MySQL</span>
				</li>
				<li>
					Implemented advanced reporting in Access that parsed data into 15 minute increments and tracked agent workflow, average handle time, and calculated time spent on a per product line basis. Used: <span class="color-software">Access, Excel</span>
				</li>
				<li>
					Changed the way customer policy and procedure; taking the company BBB rating from an F to an A+ in less than 1 year.
				</li>
				<li>
					Implemented Call Center coverage of internal level 1 & 2 IT issues freeing up the IT department for more advanced issues and upgrades.
				</li>
				<li>
					Spearheaded a custom <span class="color-software">Dynamics AX</span> class which linked CRM to order processing.  Overall time savings totaled greater than 40 hours per week. 
				</li>
				<li>
					Added Chat support to the contact center in order to increase customer contact.
				</li>
			</ul>
			</div>
		</div>
	</div>
</div>

<div class="page">
	<div class="page-container">
		<div class="header">
			<h1>Coding Projects</h1>
		</div>
		<div id="featurelist" class="optionlist" style="font-size:2em">
			<ul>
				<li id="option1" onclick="selectFeature(1);">
					Overview
				</li>
				<li>
					<span id="option2" onclick="selectFeature(2);">Tabletop Gaming SaaS</span>
					<ul>
						<li id="option3" onclick="selectFeature(3);">
							Anbient Noise Player
						</li>
						<li id="option4" onclick="selectFeature(4);">
							World Simulator
						</li>
						<li id="option5" onclick="selectFeature(5);">
							Map Navigator
						</li>
					</ul>
				</li>
				<li id="option6" onclick="selectFeature(6);">
					Image Resizer
				</li>
				<li id="option7" onclick="selectFeature(7);">
					InFocus internal	
				</li>
				<li id="option8" onclick="selectFeature(8);">
					InFocus Pricing
				</li>
				<li id="option9" onclick="selectFeature(9);">
					InFocus.com US and Global Sites
				</li>
				<li id="option10" onclick="selectFeature(10);">
					Future Project Ideas
				</li>
			</ul>
		</div>
	</div>
</div>

<div class="page">
	<div class="page-container">
		<div id="feature1" class="features">
			<h1>Overview</h1>
			<p>I started my coding journey in 2009 at InFocus Corporation. I was the Call Center Manager at that time and the company was unwilling to pay the cost for an enterprise ticketing system for the agents.  Instead the people in the call center were forced to enter information into SharePoint, which was slow, prone to bugs, and provided NO usability enhancements.  I decided if InFocus wasn't going to pay for one, then I would develop one. I ended up with a combination on Excel, MySQL, and PHP that was highly functional, though not very pretty or complex.  Over the next 4 years of managing the call center the tool grew and adapted, eventually discarding Excel for a web interface.  By the end of that 4 years I had developed a variety of solutions for problems in and out of my own department, and the company was convinced I was being under-utilized as the call center manager.  They moved me into a development roll and I have loved every minute of it.</p>
			<p>The 5 years since becoming a full-time developer have allowed for a lot of growth and self education.  I started with just PHP back in 2009, but I was ravenous for more capability.  I followed (what I imagine to be) a rather normal progression adding HTML, CSS, and Javascript before looking at more advanced libraries that had come out in the meantime.  While PHP remained my foundation I have toyed with NodeJS and Java as new languages, and would love the chance to work with them in an upcoming position.</p>
			<p>Currently I work as a Full Stack Developer for Blue Star Sports. This position was supposed to be contract (6mo) to hire, but the company made the decision to move operations down to Texas.  Since I am not willing to relocate to Texas I am on the job hunt again already.  This position, however, has given me something I was severely lacking in: large-scale collaborative development.  At InFocus I was a "One Man Show".  I worked with contractors occasionally, but I was the only developer on most projects and so my experience with more realistic development environments was extremely limited and, I can be honest, it was intimidating.  Since starting in this environment (with a brief period of adjustment), I love the work.  The ability to bounce ideas off my neighbors is invaluable, and the investigation of bugs in a large scale business application is challenging and interesting.  While I will not turn down a position where I am the sole developer at the company, I find I prefer this type of environment.</p>
		</div>
		<div id="feature2" class="features off">
	  		<div class="col-xs-12 text-center">
	  			<img src="/img/GMP Logo (medium).jpg">
	  		</div>
				<h4 class="text-center">
					<div class="col-xs-4">
						<strong>Language:</strong> JavaScript
					</div>
					<div class="col-xs-4">
						<strong>Library:</strong> Angular 1
					</div>
					<div class="col-xs-4">
						<strong>Github:</strong> <a href="https://github.com/Boggimedes/Dungeon-Master-Pro">Link</a>
					</div>
				</h4>
			<p>
				GameMaster.Pro is a web application designed to make Game Masters' daunting task of creating a rich and intricate world a little easier.  As well as make the mechanics of game run a little smoother.  There are numerous GM tools around the net that do similar things so why, you may ask, design a new one?  Well all the other tools missed one key element for me: Sound!  I find bringing sound effects (and sometimes music) into the game adds an element of richness that truly takes the experience to the next level.  So since I was unable to find something that filled the bill for me, I designed it for myself.  As it grew and improved it occured to me that other GM's might get use out of it as well. GMP was designed as an app, not a webpage so it is what I would call a "minimalist" design.  The goal was to pack as much information into the space as possible.
			</p>
			<br>
			<h3>Here are some features of Game Master Pro:</h3>
			<ul>
				<li>
					Support for up to 7.1 surround sound scenes for an immersive experience
				</li>
				<li>
					Pre-designs "Soundscapes" for common RPG Scenarios
				</li>
				<li>
					Soundscapes can have "on the fly" changes; removing specific optional effects or changing volumes.
				</li>
				<li>
					Design custom soundscapes for your own use, or share them with the community!
				</li>
				<li>
					Combat manager makes battles seem effortless. Track init, quickly load SRD or custom creatures, programed attacks at the click of a button
				</li>
				<li>
					The "World Generator" creates NPC's not only with names and descriptions, but families, friends, professions, and much much more.  You'll know your NPC's better than you know your neighbors!!
				</li>
			</ul>
			<br>
			<h3>List of planned upgrades:</h3>
			<ul>
				<li>
					Custom Skinning
				</li>
				<li>
					"Quick Sounds" (arrow flying by, door slamming, trap triggering,etc)
				</li>
				<li>
					Ability to post and browse sound scenes
				</li>
				<li>
					Hook/quest generator
				</li>
				<li>
					Ability for regions to experience "Disasters" changing
				</li>
				<li>
					Regional/Dungeon maps
				</li>
				<li>
					Interactive campaign map with NPCs and Notes
				</li>
			</ul>
		</div>
		<div id="feature3" class="features off">
				<h1>Anbient Noise Player</h1>
				<h4 class="text-center">
					<div class="col-xs-4">
						<strong>Language:</strong> JavaScript
					</div>
					<div class="col-xs-4">
						<strong>Library:</strong> Angular 1
					</div>
					<div class="col-xs-4">
						<strong>Github:</strong> <a href="https://github.com/Boggimedes/Dungeon-Master-Pro">Link</a>
					</div>
				</h4>
				<div>
					One of the most unique parts of this software, the ambient noise player allows you to build fully immersive ambient sound schemes from a library of individual sound effects. The output is in 7.1 surround and includes localized sound effects (ex. a bird call that comes from random direction/distance), looping background ambience, and "optional" effects that can be enabled or disabled on the fly. When used in a tabletop RPG setting it can create a real feel for the environment and enhance the game immensely.
				</div>
				<h3>Interesting Hurdles</h3>
				<p><strong>Tracking start and end times:</strong> Each sound effect has a different duration, and has different "delay" ranges anywhere from -60 - 600 seconds.  This delay is (generally) randomized between a high and a low limit. Once the track starts playing, the "next play" has to be caluclated and store. In the case of negative numbers this means the sound can play again before the first play is even finished, overlapping the sound effects. When you consider some sound "scenes" have 40+ effects going on, this becomes and interesting challenge to manage.</p>
				<p><strong>Sound file management:</strong> Hundreds of sound files need to be stored, and catagorized for easy locating. The files are grouped into categories, and then have tags that can be filtered to assist in locating what you are looking for.</p>
				<p><strong>Audio Context instances:</strong> Only 6 audio context instances can be in existance at any time.  So each scene being played uses a single context (and merges the sounds together).  However since these sound effects need to have fade in AND fade out capability, each time a sound is played it needs to be assigned a gain node. This node is stored in an array, but it can get quite large because the node isn't removed once the sound is finished playing. I will be working on a better way to handle this in the next version.</p>
				<h3>What I'm not proud of</h3>
				<p>There is some sloppy scope usage that grew out of hand. That is part of the reasoning for switching to ReactJS w/ Redux. Also, the sound management feels very messy. I want a cleaner system that is more structured and has some garbage management.</p>

<ul class="nav nav-tabs" id="audioTabs">
  <li class="active"><a href="#audioController" data-toggle="tab">Controller</a></li>
  <li><a href="#audioFactory" data-toggle="tab">Factory</a></li>
</ul>
 

<div class="tab-content" style="height:30%;">
					<div class="tab-pane active tab-container" id="audioController">
						<pre id='c1'>
						</pre>
					</div>
					<div class="tab-pane tab-container" id="audioFactory" >
						<pre>
.factory('soundsFactory', ['$http', '$rootScope', '$interval',
    function($http, $rootScope, $interval) {
        var scenes = {};
        var unregister = [];

        var getRandomInt = function(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }
        var mixToMono = function(buffer) {
            if (buffer.numberOfChannels == 2) {
                var pL = buffer.getChannelData(0);
                var pR = buffer.getChannelData(1);
                var length = buffer.length;

                for (var i = 0; i < length; ++i) {
                    var mono = 0.5 * (pL[i] + pR[i]);
                    pL[i] = mono;
                    pR[i] = mono;
                }
            }
        }
        return {
            playSound: function(data) {

            },
            getScenes: function(pageData) {
                return $http.post('/api/sound/scene/get', pageData);
            },
            getSounds: function(data) {
                return $http.get('/api/sounds/sounds/get');
            },
            playEffect: function(data) {

            },
            toggleScene: function(data) {
                if (typeof scenes[data.name] === 'undefined') {
                    if (scenes.length >= 5) {
                        alert("You can only play 5 scenes at once.");
                        return;
                    }
                    scenes[data.name] = angular.copy(data);
                    var aScene = scenes[data.name];

                    aScene.context = new AudioContext();
                    aScene.gainNode = [];
                    aScene.context.destination.channelCountMode = "explicit";
                    aScene.context.destination.channelInterpretation = "discrete";
                    aScene.context.destination.channelCount = aScene.context.destination.maxChannelCount;

                    for (var j = 0; j < aScene.effects.length; j++) {
                        if (aScene.effects[j].preDelay>0) {
                            aScene.effects[j].nextPlay = getRandomInt(aScene.effects[j].delayL, aScene.effects[j].delayH) 
                            + aScene.context.currentTime 
                            + aScene.effects[j].preDelay 
                            + aScene.context.currentTime;
                        } else {
                            aScene.effects[j].nextPlay = 0;
                        }
                        if (j == 0) {
                            aScene.nextPlay = aScene.effects[j].nextPlay;
                        } else if (aScene.nextPlay > aScene.effects[j].nextPlay) {
                            aScene.nextPlay = aScene.effects[j].nextPlay;
                        }
                    }
                    if (typeof aScene.nextPlay == "undefined") {
                        aScene.nextPlay = 0;
                    }

                    scenes[data.name].interval = $interval(function(){$rootScope.chkScene(data.name);},200);

                } else {
                    aScene = scenes[data.name];
                    aScene.gainNode.forEach(function(gNode) {
                        gNode.gain.linearRampToValueAtTime(gNode.gainSet, aScene.context.currentTime);
                        gNode.gain.linearRampToValueAtTime(0, aScene.context.currentTime + (aScene.fadeOut));
                    });
                    aScene.closeTime = aScene.context.currentTime + (aScene.fadeOut);
                }
            },
            chkScene: function(name) {
                var aScene = scenes[name];

                if (aScene.closeTime <= aScene.context.currentTime) {
                    aScene.context.close();
                    $interval.cancel(aScene.interval);
                    delete aScene.closeTime;
                    delete aScene.effects;
                    delete scenes[name];
                    return;
                }
                if (aScene.closeTime <= aScene.context.currentTime+aScene.fadeOut) {
                    return;
                }
                for (var j = 0; j < aScene.effects.length; j++) {
                    if (typeof aScene.effects[j].nextPlay == "undefined") {
                        aScene.effects[j].nextPlay = 0;
                    }
                    if (aScene.effects[j].nextPlay < aScene.context.currentTime + 0.5 
                    && (aScene.effects[j].active || aScene.effects[j].active == null)) {
                        var source = aScene.context.createBufferSource();
                        var perChance = 0;
                        var perRoll = getRandomInt(1, perChance);
                        var k=0;
                        var cents;
                        var rate;
                        var request;

                       aScene.effects[j].nextPlay = aScene.context.currentTime + 20000;
                        for (var k = 0; k < aScene.effects[j].sounds.length; k++) {
                            perChance += aScene.effects[j].sounds[k].chance;
                        }
                        perChance = 0;
                        for (var l = 0; l < aScene.effects[j].sounds.length; l++) {
                            perChance += aScene.effects[j].sounds[l].chance;
                            if (perChance >= perRoll) {
                                var url = "/sounds/" + aScene.effects[j].sounds[l].file;
                                k=l;
                                break;
                            }
                        }
                        if(typeof url == "undefined"){
                            aScene.effects[j].nextPlay = 0;
                            return;
                        }
                        cents = aScene.effects[j].sounds[k].pitchSet;
                        cents = cents + getRandomInt(-aScene.effects[j].sounds[k].pitchVar, aScene.effects[j].sounds[k].pitchVar * 2);
                        cents = cents * 3;
                        rate = Math.pow(2.0, cents / 1200.0);
                        source.playbackRate.value = rate;
                        request = new XMLHttpRequest();
                        request.open("GET", url + "?" + aScene.name + "," + j + "," + k, true);
                        request.responseType = "arraybuffer";
                        request.onload = function() {
                            aScene.context.decodeAudioData(request.response, function(buffer) {
                                    var gainIndex;
                                    var startSceneFade;
                                    var silence;
                                    var channelMax;
                                    var channelplayed;

                                    mixToMono(buffer);
                                    source.buffer = buffer;
                                    aScene.merger = aScene.context.createChannelMerger(8);
                                    aScene.gainNode.push(aScene.merger.context.createGain());
                                    gainIndex = aScene.gainNode.length - 1;
                                    aScene.gainNode[gainIndex].gainSet = (aScene.effects[j].sounds[k].vol / 100) * (aScene.effects[j].vol / 100) * (aScene.vol / 100);
                                    aScene.merger.connect(aScene.gainNode[gainIndex]);
                                    aScene.gainNode[gainIndex].connect(aScene.context.destination);
                                    startSceneFade = aScene.effects[j].sounds[k].fadeIn;

                                    if (aScene.context.currentTime < 2) {
                                        startSceneFade = aScene.fadeIn;
                                    }

                                    aScene.gainNode[gainIndex].gain.linearRampToValueAtTime(0, aScene.context.currentTime);
                                    aScene.gainNode[gainIndex].gain.linearRampToValueAtTime(aScene.gainNode[gainIndex].gainSet, (aScene.context.currentTime + (startSceneFade)));

                                    silence = aScene.context.createBufferSource();
                                    channelMax = (aScene.context.destination.maxChannelCount - 2);

                                    if (aScene.context.destination.maxChannelCount < 3) {
                                        (channelMax = 1)
                                    }
                                    if (aScene.effects[j].sounds[k].randLoc) {
                                        for (var i = 0; i < 7; i++) {
                                            silence.connect(aScene.merger, 0, i);
                                        }
                                        channelplayed = getRandomInt(0, channelMax);
                                        source.connect(aScene.merger, 0, channelplayed);
                                        aScene.gainNode[gainIndex].gainSet = getRandomInt(aScene.gainNode[gainIndex].gainSet * 0.2, aScene.gainNode[gainIndex].gainSet);
                                        feedback.channel=channelplayed;
                                    } else {
                                        for (var i = 0; i < 8; i++) {
                                            source.connect(aScene.merger, 0, i);
                                        }
                                        channelplayed = "all";
                                    }

                                    if (aScene.effects[j].loop) {
                                        aScene.effects[j].nextPlay = getRandomInt(aScene.effects[j].delayL, aScene.effects[j].delayH) + buffer.duration + aScene.context.currentTime - (aScene.effects[j].sounds[k].fadeIn);
                                    } else {
                                        aScene.effects[j].nextPlay = 99999999;
                                        if(!aScene.effects[j].sounds[k].loop) {
                                            aScene.closeTime = aScene.context.currentTime + (buffer.duration);
                                        }
                                    }

                                    if(aScene.effects[j].sounds[k].loop) {
                                        source.loop=true;
                                        aScene.effects[j].nextPlay = 9999999;
                                    }
                                    source.start(0);

                                    if(aScene.effects[j].sounds[k].fadeOut>0){
                                        aScene.gainNode[gainIndex].gain.linearRampToValueAtTime(aScene.gainNode[gainIndex].gainSet, (aScene.context.currentTime + buffer.duration - aScene.effects[j].sounds[k].fadeOut));
                                        aScene.gainNode[gainIndex].gain.linearRampToValueAtTime(0, (aScene.context.currentTime + buffer.duration));
                                    }
                                },
                                function(e) {
                                    "Error with decoding audio data" + e
                                });
                        };
                        request.send();
                        return;
                    }
                }
            },
            scenes
        };
    }
])
						</pre>
					</div>
				</div>
		</div>
		<div id="feature4" class="features off">
				<h1>World Simulator</h1>
				<h4 class="text-center">
					<div class="col-xs-4">
						<strong>Language:</strong> PHP
					</div>
					<div class="col-xs-4">
						<strong>Library:</strong> None
					</div>
					<div class="col-xs-4">
						<strong>Github:</strong> <a href="https://github.com/Boggimedes/Dungeon-Master-Pro">Link</a>
					</div>
				</h4>
				<div>
					The world simulator was a very fun and challenging part of this project. The system allows for you to enter parameters for your "world" and it will generate NPCs (characters/people that live in the world). These NPCs would live their lives, get married, have kids, start occupations, and die.  All of which is tracked and calculated based on chance.  The idea is that these aren't ALL the people in the world (obviously, since there are only a few thousand at most), but instead are just the "relavant" people to the story line.  These are the NPCs that the Player Characters have a higher chance to meet.
				</div>
				<h3>Interesting Hurdles</h3>
				<p><strong>Life and Death:</strong> The goal was for the "world" to take on a life of its own. This happened in a very real way. A good chunk of time was spent balancing birth and death rates so the size of the population wouldn't grow exponentially, but also wouldn't die out.  I "killed" many civilizations fine tuning this.  In the end I added a bit of "protection" code that changed the birth and death rates when populations became exceptionally high or exceptionally low.</p>
				<p><strong>Research:</strong> I wanted some semblance of realism so I included things like same sex relationships, childbirth out of marriage (though, more common if married), and spinsters that never marry.  I ended up doing a lot of research on average statistics for these calculations.</p>
				<p><strong>Mixing Races:</strong> The design of this system is based on a fantasy world so the idea of differnt races having children together made me want to represent that in code.  So, for example, when a Human and an Elf have a child, it is a Half-Elf.  This was interesting to code, and fun to work out</p>
				<h3>What I'm not proud of</h3>
				<p>There is very little in this that I am not pleased with.  There are definitely some efficiency upgrades that could have been done, and many of the SQL queries would be better served as stored procedured, but all in all I like how this turned out</p>
				<h3>A Few Interesting Functions</h3>
				<div style="height:35%;overflow-x:auto;">
						<pre style="white-space: pre-wrap;">
													<code data-language="php" class="rainbow">

private function deathCheck(&$cc)  {
	$a=2.2765E-06;
	$b=-0.00040584;
	$c=0.022322;
	$d=-0.37058;
	$f=1.377;
	$x = ($cc->age*100)/$cc->race->maxAge;

	$deathChance = max($a*pow($x,4) + $b*pow($x,3) + $c*pow($x,2) + $d*$x + $f,0.1)*10;
	$preSQL = "UPDATE citizen SET";
	if ((mt_rand(1,1000) < $deathChance || $cc->age >= $cc->race->maxAge) && $cc->immortal != 1) {
	    $this->racialBalance[$cc->race->name]--;
        $racialBalance = null;
        foreach($this->region->racialBalance as $key=>$race) {if ($key == $cc->race->id) {
        	$racialBalance = $this->region->racialBalance->$key->value;
        }

        if ($racialBalance != null && $racialBalance > $this->racialBalance[$cc->race->name]) {
	        if (mt_rand(1,100) < 50) {
	        	$transplantGender = "male";
	        } else {
	        	$transplantGender = "female";
	        }
            $transplant = $this->newCitizen(mt_rand($cc->race->adulthood,$cc->race->adulthood*2), $cc->race, $transplantGender, $cc->generation);
            $transplant->race = $cc->race;
            $transplant->region = $cc->region;
            $transplant->children = explode(",",$transplant->children);
            $this->citizens[$transplant->id] = $transplant;
		    $this->racialBalance[$cc->race->name]++;
        }
   	    $cc->alive=0;
		$note = $cc->notes."Died in ".$this->region->epoch." at ".$cc->age." years old \n";
		if (gettype($cc->spouse) == "object") {
			$note = $cc->spouse->notes."Spouse died in ".$this->region->epoch."\n";
			if ($cc->gender == 'male' && $cc->spouse->age > $cc->race->middleAge && mt_rand(1,20) == 1) {
				$cc->spouse->married = 0;
			}
			if ($cc->gender == 'male' && $cc->spouse->age < $cc->race->middleAge && mt_rand(1,10) <= 3) {
				$cc->spouse->married = 0;
			}
			if ($cc->gender == 'female' &&  mt_rand(1,10) <= 3) {
				$cc->spouse->married = 0;
			}

			$cc->spouse->notes = $cc->spouse->notes."Spouse(".$cc->firstName.") died in ".$this->region->epoch."\n";

		}
		if (!is_array($cc->children)) {
			return;
		}
		if ($cc->gender == "male") {
			$parentGender = "Father";
		} else {
			$parentGender = "mother";
		}
		foreach($cc->children as $child) {
			if ($child == "") {
				continue;
			}
			$note = $parentGender." died in ".$this->region->epoch." when he/she was ";
			if (array_key_exists($child, $this->citizens)) {
				$this->citizens[$child]->notes = $this->citizens[$child]->notes.$note.$this->citizens[$child]->age."\n";
			}
		}
	} else {
		$cc->age += 1; 
		if ($cc->age >= $cc->race->oldAge && $cc->age-1 < $cc->race->oldAge) $this->racialBalance[$cc->race->name]--;
	}
}


function ageRegion($years) {
	$this->getCitizens(json_decode('{"alive":1,"excluded":0}'));
	for($y=0;$y<$years;$y++) {
		$this->yearlyBirths=0;
		$this->region->epoch++;
		$this->wives=[];
		$this->fathers=[];
		foreach($this->citizens as &$k) {
			if ($k->gender == 'female'
			&& $k->alive == 1
			&& (!$k->married || $k->married == null || mt_rand(1,50) == 1)) {
				$this->wives[$k->id]=&$k;
			}
			if ($k->gender == 'male'
			&& $k->alive == 1
			&& ($k->married || mt_rand(1,20)==1)) {
				$this->fathers[$k->id]=&$k;
			}
		}

		foreach($this->citizens as &$cc) {
			$spliceDead=[];
			if ($cc->alive == 0) {
				continue;
			}
			$this->deathCheck($cc);  
			if ($cc->alive) {
				$this->weddingBells($cc);  
				$this->newChild($cc); 
				if ($cc->alive && $cc->age>$cc->race->adulthood/2) {
					$this->ratRace($cc);
				}
			}
		}
	}
	$query  = "DELETE citizen FROM citizen 
		JOIN (SELECT MAX(generation) as gen, race FROM gm_master_tools.citizen 
		WHERE alive = 0 AND account = $this->account AND region = {$this->region->id} group by race) as gMin 
		on citizen.race = gMin.race 
		WHERE alive = 0 
		AND account = $this->account 
		AND region = {$this->region->id} 
		AND generation < gMin.gen-10";
	$this->mysqli->query($query);

	$this->sqlArray=[];
	foreach($this->citizens as $citizen) {
	 	if (is_object($citizen->spouse)) {
	 		$tmpSpouse = $citizen->spouse->id;
	 		unset($citizen->spouse);
	 		$citizen->spouse = $tmpSpouse;
	 	}
	 	$citizen->race = $citizen->race->id;
	 	$citizen->features = json_encode($citizen->features);
	 	$citizen->children = implode(",",$citizen->children);
	 	$query = "REPLACE INTO citizen SET ";
 		foreach($citizen as $key=>$value) {
 			if ($value === NULL ) $query = $query;
 				elseif (is_numeric($value) || $value == "NULL") $query .= $key." = ".$value.",";
 					else $query .= $key." = '".$this->mysqli->real_escape_string($value)."',";
 		}
 		$query = rtrim($query, ',');
 		$this->sqlArray[]=$query;
	}
	$this->multiQuery($this->sqlArray);
	$this->region->stats = [];
	$query = "SELECT ROUND(AVG(age)) as avgAge, count(firstName) as livingCount, race.name 
	FROM citizen JOIN race on citizen.race = race.id 
	WHERE alive = 1 
	AND citizen.account = $this->account 
	AND citizen.immortal = 0 
	AND region = {$this->region->id} group by race";
	if ($result = $this->mysqli->query($query)) {
		while($row=$result->fetch_object()) {
			$this->region->stats[] = $row;
			}
			$result->close();
		}
	$return = json_encode($this->region);
	$this->region->stats = json_encode($this->region->stats);
	$this->region->racialBalance = json_encode($this->region->racialBalance);
	$this->region->profBalance = json_encode($this->region->profBalance);
	$this->upsertRecord($this->region,"region");
	  
	return $return;
}

private function ratRace(&$cc) {

	if ($cc->profession != "") {
		if (array_key_exists($cc->profession, $this->professions)) {
			$maxAge = $this->professions[$cc->profession]->maxAge;
			if ($maxAge == "none") {
				$maxAge=9999;
			} else {
				$maxAge = $cc->race->$maxAge;
			}
			if ($cc->age >= $maxAge) {
				if (mt_rand(1,12) == 1) {
					$cc->notes.="Retired at ".$cc->age.".\n";
					$cc->profession = "Retired ".$cc->profession;
				}
			}
		}
		return;
	}
	$getAJob = 10;
	if ($cc->age < $cc->race->adulthood) {
		$getAJob = 30;
	}
	if (mt_rand(1,$getAJob)==1) {
		$profBalance = $this->region->profBalance;
		$balanceTotal=0;
		$profList=[];
		foreach($profBalance as $prof) {
			$tmpValue = $prof->value;
			if (@$this->citizens[$cc->father]->profession == $prof->prof
			|| @$this->citizens[$cc->father]->profession == "Retired ".$prof->prof
			|| @$this->citizens[$cc->mother]->profession == $prof->prof 
			|| @$this->citizens[$cc->mother]->profession == "Retired ".$prof->prof ) {
				$tmpValue = $prof->value*3;
			}
			$balanceTotal += $tmpValue;
			$profList[]=array($prof->prof,$tmpValue);
		}
		$randResult = mt_rand(0,$balanceTotal);
		foreach($profList as $prof) {
			$balanceTotal -= $prof[1];
			$minAge = $this->professions[$prof[0]]->minAge;
			if ($minAge == "none") {
				$minAge=0;
			} else {
				$minAge = $cc->race->$minAge;
			}
			$maxAge = $this->professions[$prof[0]]->maxAge;
			if ($maxAge == "none") {
				$maxAge=9999;
			} else {
				$maxAge = $cc->race->$maxAge;
			}

			if ($randResult>=$balanceTotal && $cc->age >= $minAge && $cc->age < $maxAge) {
				$cc->notes.="Became a/an $prof[0] at ".$cc->age."\n";
				$cc->profession = $prof[0];
				return;
			}
		}
	}
}
</code>
						</pre>
					</div>
				</div>
		</div>
		<div id="feature5" class="features off">
				<h1>Map Navigator</h1>
				<h4 class="text-center">
					<div class="col-xs-4">
						<strong>Language:</strong> JavaScript
					</div>
					<div class="col-xs-4">
						<strong>Library:</strong> Angular 1
					</div>
					<div class="col-xs-4">
						<strong>Github:</strong> <a href="https://github.com/Boggimedes/Dungeon-Master-Pro">Link</a>
					</div>
				</h4>
				<div>
					Map navigator allows uploaded images to be navigated via googleMaps api. Locations can be added with HTML notes to keep all the information you need right at your fingertips.
				</div>
				<h3>Interesting Hurdles</h3>
				<p><strong>Map Scope:</strong> Since the mapped images are much smaller than googleMaps api was designed for, I saw some odd side effects that I have not yet been able to overcome.  The primary one is the "repeat" of the "locations" on the map, so if you scrolled too far to the right or the left you saw location icons floating in the background off the side of the main map.</p>
				<p><strong>Note at zoom level:</strong> I wanted the ability for different "layers" of notes, so more detailed information can be shown when the map is zoomed in.</p>
				<h3>What I'm not proud of</h3>
				<p>The use of the API itself is a little clumsy since I'm trying to warp it to my purpose.  I'm thinking it may be better to code my own custom mapping system since there is so much in googleMaps api that I don't need/use.</p>
				<ul class="nav nav-tabs" id="mapTabs">
				  <li class="active"><a href="#datasource" data-toggle="tab">Datasource</a></li>
				  <li><a href="#mapServices" data-toggle="tab">Service</a></li>
				</ul>

				<div class="tab-content" style="height:48%;"">
					<div class="tab-pane active tab-container" id="datasource">
						<pre>
.factory('mapDatasource', ['$timeout', '$http',
    function($timeout, $http) {
        var nf = '';
        var maps = [];
        return {
            getMaps: function(pageData) {
                return $http.post('/api/map/getMaps', pageData);
            },
            getMarkers: function(pageData) {
                return $http.post('/api/map/getMarkers', pageData);
            },
            addMap: function(pageData) {
                return $http.post('/api/map/addMap', pageData);
            },
            addMarker: function(pageData) {
                return $http.post('/api/map/addMarker', pageData);
            },
            updateMap: function(pageData) {
                return $http.post('/api/map/updateMap', pageData);
            },
            updateMarker: function(pageData) {
                return $http.post('/api/map/updateMarker', pageData);
            },
            deleteMap: function(pageData) {
                return $http.post('/api/map/deleteMap', pageData);
            },
            deleteMarker: function(pageData) {
                return $http.post('/api/map/deleteMarker', pageData);
            }
        };
    }
])						</pre>
					</div>
					<div class="tab-pane tab-container" id="mapServices">
						<pre>
.factory('mapService', ['mapDatasource',
    function(mapDatasource) {
        var map;
        var lastOpenInfoWin;
        var zoomLevel;
        var places;
        var toggle = true;

        var img;
        var mapId;
        var target;
        var src;
        var centreLat;
        var centreLon;
        var initialZoom;
        var imageWraps;
        var gmicMapType;
        var fieldScope;
        var markerFields;
        var currentIndex;



        function Tooltip(options) {

            // Now initialize all properties.
            this.marker_ = options.marker;
            this.content_ = options.content;
            this.map_ = options.marker.get('map');
            this.cssClass_ = options.cssClass || null;

            // We define a property to hold the content's
            // div. We'll actually create this div
            // upon receipt of the add() method so we'll
            // leave it null for now.
            this.div_ = null;

            //Explicitly call setMap on this overlay
            this.setMap(this.map_);
            var me = this;
            // Show tooltip on mouseover event.
            google.maps.event.addListener(me.marker_, 'mouseover', function () {
            var overlayProjection = me.getProjection();

            // Retrieve the coordinates of the marker
            // in latlngs and convert them to pixels coordinates.
            // We'll use these coordinates to place the DIV.
            var ne = overlayProjection.fromLatLngToDivPixel(me.marker_.getPosition());

            // Position the DIV.
            var div = me.div_;
            div.style.left = ne.x + 'px';
            div.style.top = ne.y + 'px';
                me.show();
            });
            // Hide tooltip on mouseout event.
            google.maps.event.addListener(me.marker_, 'mouseout', function () {
                me.hide();
            });
        }
        // Now we extend google.maps.OverlayView()
        Tooltip.prototype = new google.maps.OverlayView();

        // onAdd is one of the functions that we must implement,
        // it will be called when the map is ready for the overlay to be attached.
        Tooltip.prototype.onAdd = function () {

            // Create the DIV and set some basic attributes.
            var div = document.createElement('DIV');
            div.style.position = "absolute";
            // Hide tooltip
            div.style.visibility = "hidden";
            if (this.cssClass_)
                div.className += " " + this.cssClass_;

            //Attach content to the DIV.
            div.innerHTML = this.content_;

            // Set the overlay's div_ property to this DIV
            this.div_ = div;

            // We add an overlay to a map via one of the map's panes.
            // We'll add this overlay to the floatPane pane.
            var panes = this.getPanes();
            panes.floatPane.appendChild(this.div_);

        };
        // We here implement draw
        Tooltip.prototype.draw = function () {

            // Position the overlay. We use the position of the marker
            // to peg it to the correct position, just northeast of the marker.
            // We need to retrieve the projection from this overlay to do this.
            var overlayProjection = this.getProjection();

            // Retrieve the coordinates of the marker
            // in latlngs and convert them to pixels coordinates.
            // We'll use these coordinates to place the DIV.
            var ne = overlayProjection.fromLatLngToDivPixel(this.marker_.getPosition());

            // Position the DIV.
            var div = this.div_;
            div.style.left = ne.x + 'px';
            div.style.top = ne.y + 'px';

        };
        // We here implement onRemove
        Tooltip.prototype.onRemove = function () {
            this.div_.parentNode.removeChild(this.div_);
        };

        // Note that the visibility property must be a string enclosed in quotes
        Tooltip.prototype.hide = function () {
            if (this.div_) {
                this.div_.style.visibility = "hidden";
            }
        };

        Tooltip.prototype.show = function () {
            if (this.div_) {
                this.div_.style.visibility = "visible";
            }
        };

        function createInfoWindow(marker, key, markerFields) {
              //create an infowindow for this marker
              var infowindow = new google.maps.InfoWindow({
                  content: places[key].html,
                  maxWidth: 550
              });

                            //create a tooltip
              var tooltipOptions = {
                  marker: marker,
                  content: places[key].name,
                  cssClass: 'map-tooltip' // name of a css class to apply to tooltip
              };
              var tooltip = new Tooltip(tooltipOptions);


              //open infowindo on click event on marker.
              google.maps.event.addListener(marker, 'dragend', function () {

              markerFields.ttip = places[key].name;
              markerFields.lat = marker.getPosition().lat();
              markerFields.lng = marker.getPosition().lng();
              markerFields.html = places[key].html;
              markerFields.zoom = places[key].zoom;
              markerFields.id = places[key].id;
              if(Math.floor(marker.getPosition().lat()) != Math.floor(places[key].latitude) || Math.floor(marker.getPosition().lng()) != Math.floor(places[key].longitude)) markerFields.warn = true;
                else markerFields.warn = false;

            angular.forEach(markerFields.checkModel, function (value, key) {
                markerFields.checkModel[key]=false;
              if (markerFields.zoom.indexOf(key+2)>=0) markerFields.checkModel[key]=true;
            });
              });

              google.maps.event.addListener(marker, 'click', function () {

              markerFields.ttip = places[key].name;
              markerFields.lat = marker.getPosition().lat();
              markerFields.lng = marker.getPosition().lng();
              markerFields.html = places[key].html;
              markerFields.zoom = places[key].zoom;
              markerFields.id = places[key].id;
              if(Math.floor(marker.getPosition().lat()) != Math.floor(places[key].latitude) || Math.floor(marker.getPosition().lng()) != Math.floor(places[key].longitude)) markerFields.warn = true;
                else markerFields.warn = false;
            angular.forEach(markerFields.checkModel, function (value, key) {
                markerFields.checkModel[key]=false;

              if (markerFields.zoom.indexOf(key+2)>=0) markerFields.checkModel[key]=true;
            });

                if(infowindow.position == marker.position && infowindow.anchor) infowindow.close();
                else {
                  if (lastOpenInfoWin) lastOpenInfoWin.close();
                  lastOpenInfoWin = infowindow;
                  infowindow.open(marker.get('map'), marker);
                  }
              });
        }
          // Here is where we create a tooltip for each marker,
          // with content set to plcaes[placeindex].tooltip_html
        function createTooltip(marker, key) {
              }


        function GMICMapType(img) {
            this.sourceImg = img;
            this.Cache = Array();
            this.opacity = 1.0;
        }



        GMICMapType.prototype.tileSize = new google.maps.Size(256, 256);
        GMICMapType.prototype.maxZoom = 19;
        GMICMapType.prototype.getTile = function(coord, zoom, ownerDocument) {
            var c = Math.pow(2, zoom);
            var tilex=coord.x,tiley=coord.y;
            if (false) {
                if (tilex < 0) tilex=c+tilex%c;
                if (tilex>=c) tilex=tilex%c;
                if (tiley < 0) tiley=c+tiley%c;
                if (tiley>=c) tiley=tiley%c;
            }
            else {
                if ((tilex < 0)||(tilex>=c)||(tiley < 0)||(tiley>=c))
                {
                    var blank = ownerDocument.createElement('DIV');
                    blank.style.width = this.tileSize.width + 'px';
                    blank.style.height = this.tileSize.height + 'px';
                    return blank;
                }
            }

            var img = ownerDocument.createElement('img');

            img.id = "t_" + zoom + "_" + tilex + "_" + tiley;
            img.style.width = this.tileSize.width + 'px';
            img.style.height = this.tileSize.height + 'px';

            var canvas = ownerDocument.createElement('canvas');
            canvas.width = this.tileSize.width;
            canvas.height = this.tileSize.height;
            var ctx = canvas.getContext("2d");
            ctx.drawImage(this.sourceImg, this.sourceImg.width / c * tilex, this.sourceImg.height / c * tiley, this.sourceImg.width / c, this.sourceImg.height / c, 0, 0, this.tileSize.width, this.tileSize.height);
            img.src = canvas.toDataURL();

            this.Cache.push(img);

            return img;
        };

        GMICMapType.prototype.realeaseTile = function(tile) {
            var idx = this.Cache.indexOf(tile);
            if(idx!=-1) this.Cache.splice(idx, 1);
            tile=null;
        };

        GMICMapType.prototype.name = "GMap-JSlicer";
        GMICMapType.prototype.alt = "GMap-JSlicer";
        GMICMapType.prototype.setOpacity = function(newOpacity) {
            this.opacity = newOpacity;
            for (var i = 0; i < this.Cache.length; i++) {
                this.Cache[i].style.opacity = newOpacity;
                this.Cache[i].style.filter = "alpha(opacity=" + newOpacity * 100 + ")";
            }
        };


        return{

            init: function init(target, src, id) {

                this.mapId = id;
                this.target = target;
                this.src = src;
                this.toggle = true;

                if(!this.centreLat) this.centreLat = 0.0;
                if(!this.centreLon) this.centreLon = 0.0;
                if(!this.initialZoom) this.initialZoom = 3;
                this.imageWraps = false;
                this.markerFields.map_id = id;

                var that = this;

                var downloadAsset = function(src, callback) {
                    if(!that.img) {
                        var img = document.createElement('img');

                        img.onerror = function() {
                            if(callback) {
                                callback(false);
                            }
                        };

                        img.onload = function() {
                            var canvas = document.createElement('canvas');
                            var dimension = Math.max(img.width, img.height);
                            canvas.width = dimension;
                            canvas.height = dimension;
                            var ctx = canvas.getContext("2d");
                            ctx.drawImage(img, (dimension - img.width) / 2, (dimension - img.height) / 2);

                            img.onload = function() {
                                img.removeEventListener('onload', img.onload, false);
                                that.img = img;
                                if(callback) {
                                    callback(img);
                                }
                            };

                            img.src = canvas.toDataURL();
                        };

                        img.src = src;
                    } else {
                        if(callback) {
                            callback(img);
                        }
                    }
                };

                var latlng = new google.maps.LatLng(that.centreLat, that.centreLon);
                var myOptions = {
                    zoom: that.initialZoom,
                    minZoom: 2,
                    maxZoom: 5,
                    center: latlng,
                    panControl: true,
                    zoomControl: true,
                    mapTypeControl: false,
                    scaleControl: false,
                    streetViewControl: false,
                    overviewMapControl: false,
                    mapTypeControlOptions: {
                        mapTypeIds: ["GameMap"],
                        position: google.maps.ControlPosition.TOP_RIGHT,
                        style: google.maps.MapTypeControlStyle.DEFAULT
                    },
                    mapTypeId: "GameMap"
                };

                map = new google.maps.Map(that.target, myOptions);
                var gmicMapType = new GMICMapType(that.img);
                map.mapTypes.set("GameMap",gmicMapType);

                if(!that.imageWraps) {
                    that.setBounds();
                }

                google.maps.event.addListener(map, 'click', function(event) {
                    if(lastOpenInfoWin) {
                         lastOpenInfoWin.close();
                         that.markerFields.id = '';
                       }

                    that.markerFields.lng = event.latLng.lng();
                    that.markerFields.lat = event.latLng.lat();
                });

                google.maps.event.addListener(map, 'zoom_changed', function() {
                    zoomLevel = map.getZoom();
                        for (var i = 0; i < places.length; i++) {
                             if(places[i].zoom.indexOf(zoomLevel)>=0 && toggle) places[i].marker.setVisible(true);
                             else places[i].marker.setVisible(false);
                         }
                });

                mapDatasource.getMarkers({"map_id":that.mapId}).then(function(response) {
                    places = response.data;
                    for (var key = 0; key < places.length; key++) {
                        var myPlace = places[key];
                        if (myPlace.latitude) {
                            places[key].marker = new google.maps.Marker({
                                map: map,
                                icon: "/demo/note.png",
                                draggable:true,
                                position: new google.maps.LatLng(myPlace.latitude, myPlace.longitude)
                             });
                             createInfoWindow(places[key].marker, key, that.markerFields);
                            createTooltip(places[key].marker, key);
                            zoomLevel = map.getZoom();
                            if(places[key].zoom.indexOf(zoomLevel) < 0) {
                                places[key].marker.setVisible(false);
                            }
                        }
                    }
                }, function(err) {});
                downloadAsset(this.src, function() {
                    load();
                });
            },
            setBounds: function setBounds() {
                var allowedBounds = new google.maps.LatLngBounds(
                     new google.maps.LatLng(-165.0, -165.0),
                     new google.maps.LatLng(165.0, 165.0)
                );

                var lastValidCenter = map.getCenter();

                google.maps.event.addListener(map, 'center_changed', function() {
                    if (allowedBounds.contains(map.getCenter())) {
                        lastValidCenter = map.getCenter();
                        return;
                    }

                    map.panTo(lastValidCenter);
                });
            },
            redraw: function redraw() {
                var zoom = map.getZoom();
                map.setZoom(0);
                setTimeout(function(){map.setZoom(zoom);}, 0);
            },
            setFields: function setFields(fields){
                this.markerFields = fields;
                },
            toggleMarkers: function toggleMarkers(){
                var i;
                if(toggle){
                    toggle = !toggle;
                        for (i = 0; i < places.length; i++) {
                            places[i].marker.setVisible(false);
                        }
                }
                else{
                    toggle = !toggle;
                    zoomLevel = map.getZoom();
                        for (i = 0; i < places.length; i++) {
                            if(places[i].zoom.indexOf(zoomLevel)>=0) places[i].marker.setVisible(true);
                        }
                }
            },
            toggleTooltips:   function toggleTooltips(){
                var tooltips = document.getElementsByClassName('map-tooltip');
                var i;
                if(document.getElementsByClassName('hidden-tooltips').length>0){
                    for (i = 0; i <     tooltips.length; i++) {
                        tooltips[i].classList.remove("hidden-tooltips");
                    }
                }
                else{
                    for (i = 0; i <     tooltips.length; i++)
                    {
                        tooltips[i].classList.add("hidden-tooltips");
                    }
                }
            },
            reloadMap: function reloadMap(newMarker){
                this.centreLat = map.getCenter().lat();
                this.centreLon = map.getCenter().lng();
                this.initialZoom = map.getZoom();
                this.init(this.target, this.src, this.mapId);
            }
        };
    }
])
						</pre>
					</div>
				</div>
		</div>
		<div id="feature6" class="features off">
				<h1>Image Resizer</h1>
				<h4 class="text-center">
					<div class="col-xs-4">
						<strong>Language:</strong> PHP
					</div>
					<div class="col-xs-4">
						<strong>Library:</strong> None
					</div>
					<div class="col-xs-4">
						<strong>Github:</strong> <a href="https://github.com/Boggimedes/Image-Size">Link</a>
					</div>
				</h4>
				<div>
					A script for use with a large scale website that allows you to store only LARGE copies in your image library but benefit from the speed and image quality of images sized specifically for your use.
				</div>
					<h3>Code</h3>
					<div class="col-xs-12" style="height:78%;overflow-x:auto;">
						<pre>
function filemtime_remote($uri) {
	$uri = parse_url($uri);
	$uri['port'] = isset($uri['port']) ? $uri['port'] : 80;
	$handle = @fsockopen($uri['host'], $uri['port']);
	if(! $handle) return 0;
	fputs($handle, "HEAD $uri[path] HTTP/1.1\r\nHost: $uri[host]\r\n\r\n");
	$result = 0;
	while(! feof($handle)) {
		$line = fgets($handle, 1024);
		if(! trim($line)) break;
		$col = strpos($line, ':');
		if($col !== false) {
			$header = trim(substr($line, 0, $col));
			$value = trim(substr($line, $col + 1));
			if(strtolower($header) == 'last-modified') {
				$result = strtotime($value);
				break;
			}
		}
	}
	fclose($handle);
	return $result;
}
// $b sets a max dimension for the larger of either width or height.  $w is max width. $h is max height.
function imageResize($image, $b = null, $h = null, $w = null, $prefix = "{default prefix-,}", $suffix = "{-suffix1.*,-suffix2.*,.*}"){

	$GENERATE_CACHE = true;	// if true, generates caches of the thumbnailed images
	$CACHE_PATH = $_SERVER['DOCUMENT_ROOT'] . '/tmp/imagethumbs/';	// the full path where thumbnails should be saved (if $GENERATE_CACHE is enabled)
	$BROKEN_IMAGE_PATH = 'no-image.png';	// the full path to the image to be shown when a non-valid image is required or found
	$BASE_HREF = $_SERVER['DOCUMENT_ROOT'] . '/resources/images/';	// the path string to prepend to every image requested (except external resources, if they are allowed)
	$ALLOW_HTTP_IMAGES = false;	// allow requests of http:// or ftp:// resources? Make sure that in php.ini "allow_url_fopen" is set to "true"

	filemtime_remote($uri);

	// if not a static path to an image find image in default path
	if (! eregi("^http://", $image) && ! eregi("^ftp://", $image)) {
		$filename = glob($BASE_HREF . $prefix . "{" . $image . "}" . $suffix,GLOB_BRACE);
		    $image = $filename[0];
		// if image cannot be located default to "no-image" file
		if (empty($filename[0])) {
			$image = $BASE_HREF . $BROKEN_IMAGE_PATH;
		}
	}

	$src_size = getimagesize($image);
	if (isset($w) && ereg("^[0-9]+$", $w)) {
		$MAX_WIDTH = $w;
	} else {
		$MAX_WIDTH = $src_size[0];
	}
	if (isset($h) && ereg("^[0-9]+$", $h)) {
		$MAX_HEIGHT = $h;
	} else {
		$MAX_HEIGHT = $src_size[1];
	}
	if (isset($b) && ereg("^[0-9]+$", $b)) {
		$MAX_BOTH = $b;
	}

	if($src_size[1] > $src_size[0] && isset($b) && ereg("^[0-9]+$", $b)){
		$MAX_HEIGHT = $MAX_BOTH;
		$MAX_WIDTH = $src_size[0];
	} else if(isset($b) && ereg("^[0-9]+$", $b)){
		$MAX_HEIGHT = $src_size[1];
		$MAX_WIDTH = $MAX_BOTH;
	}

	if (! $ALLOW_HTTP_IMAGES && (eregi("^http://", $image) || eregi("^ftp://", $image))) {
		$data = readfile($BROKEN_IMAGE_PATH);
		$dest = imagecreatefromstring($data);
		header('Content-type: image/jpeg');
		imagejpeg($dest);
		ob_end_flush();
		exit();
	}

	// for creating md5 thumbnail file that will update when file is changed
	$full_url = str_replace('http://', '', $image);
	$full_url = filemtime_remote($image) . '_' . $MAX_WIDTH . '_' . $MAX_HEIGHT . '_' . $full_url;

	$ext = strtolower(substr($image, strrpos($image, '.') + 1));

	$thumb_file = md5($full_url) . '_' . basename($image);
	$png_thumb_file = str_replace('.' . $ext, '.png', $thumb_file);
	$gif_thumb_file = str_replace('.' . $ext, '.gif', $thumb_file);
	$jpg_thumb_file = str_replace('.' . $ext, '.jpg', $thumb_file);



	if ((! file_exists($CACHE_PATH . $png_thumb_file) &&
		   ! file_exists($CACHE_PATH . $gif_thumb_file) &&
		   ! file_exists($CACHE_PATH . $jpg_thumb_file))) {

		// resize the image (if needed)
		if ($src_size[0] > $MAX_WIDTH && $src_size[1] > $MAX_HEIGHT) {
			if ($src_size[0] > $src_size[1]) {
				$dest_width = $MAX_WIDTH;
				$dest_height = ($src_size[1] * $MAX_WIDTH) / $src_size[0];
			} else {
				$dest_width = ($src_size[0] * $MAX_HEIGHT) / $src_size[1];
				$dest_height = $MAX_HEIGHT;
			}
		} else if ($src_size[0] > $MAX_WIDTH) {
			$dest_width = $MAX_WIDTH;
			$dest_height = ($src_size[1] * $MAX_WIDTH) / $src_size[0];
		} else if ($src_size[1] > $MAX_HEIGHT) {
			$dest_width = ($src_size[0] * $MAX_HEIGHT) / $src_size[1];
			$dest_height = $MAX_HEIGHT;
		} else {
			$dest_width = $src_size[0];
			$dest_height = $src_size[1];
		}

		// force resizing in both dimensions
		if ($w != null &&  $h != null) {
			$dest_width = $MAX_WIDTH;
			$dest_height = $MAX_HEIGHT;
		}

		if (extension_loaded('gd')) {

			// check the source file format
			if ($ext == 'jpg' || $ext == 'jpeg'){
				$src = imagecreatefromjpeg($image) or $failed = true;
			} else if ($ext == 'gif') {
				$src = imagecreatefromgif($image) or $failed = true;
			} elseif ($ext == 'png') {
				$src = imagecreatefrompng($image) or $failed = true;
			} else {
				$failed = true;
			}

			if($failed != true) {
				// create and output the destination image
				$dest = imagecreatetruecolor($dest_width, $dest_height) or die('Cannot initialize new GD image stream');
				imagecolortransparent($dest , imagecolorallocatealpha($dest , 0, 0, 0, 127));
				imagealphablending($dest , false);
				imagesavealpha($dest , true);
				imagecopyresampled($dest, $src, 0, 0, 0, 0, $dest_width, $dest_height, $src_size[0], $src_size[1]);

				if (imagetypes() && IMG_PNG) {
					if ($GENERATE_CACHE) imagepng($dest , $CACHE_PATH . $png_thumb_file);
					return "/tmp/imagethumbs/" . $png_thumb_file;
				} elseif (imagetypes() && IMG_JPG) {
					if ($GENERATE_CACHE) imagejpeg($dest , $CACHE_PATH . $jpg_thumb_file);
					return "/tmp/imagethumbs/" . $jpg_thumb_file;
				} else if (imagetypes() && IMG_GIF) {
					if ($GENERATE_CACHE) imagegif($dest , $CACHE_PATH . $gif_thumb_file);
					return "/tmp/imagethumbs/" . $gif_thumb_file;
				} else {
					$data = readfile($BROKEN_IMAGE_PATH);
					$dest = imagecreatefromstring($data);
					return $dest;
				}
			}
			else {
				$data = readfile($BROKEN_IMAGE_PATH);
				$dest = imagecreatefromstring($data);
				return $dest;
			}
		} else {
			print 'GD-library support is not available';
		}
	} else {
		if (file_exists($CACHE_PATH . $png_thumb_file)) {
			touch($CACHE_PATH . $png_thumb_file);
			return "/tmp/imagethumbs/" . $png_thumb_file;
		} else if (file_exists($CACHE_PATH . $jpg_thumb_file)) {
			touch($CACHE_PATH . $jpg_thumb_file);
			return "/tmp/imagethumbs/" . $jpg_thumb_file;
		} else if (file_exists($CACHE_PATH . $gif_thumb_file)) {
			touch($CACHE_PATH . $gif_thumb_file);
			return "/tmp/imagethumbs/" . $gif_thumb_file;
		} else {
			return $BROKEN_IMAGE_PATH;
		}
	}
}
						</pre>
					</div>
		</div>
		<div id="feature7" class="features off">
				<h1>InFocus internal</h1>
				<h4 class="text-center">
					<div class="col-xs-4">
						<strong>Language:</strong> PHP
					</div>
					<div class="col-xs-4">
						<strong>Library:</strong> CraftCMS
					</div>
					<div class="col-xs-4">
						<strong>Github:</strong> <a href="https://github.com/Boggimedes/InFocus-Internal">Link</a>
					</div>
				</h4>
				<div>
					This is the internal site for InFocus Corporation. It is used for custom internal tools that I developed for the company over the years. These tools range from marketing, pricing, logistics, and the call center. Some of these tools were developed to replace costly or obsolete software/processes, and some were original ideas to increase general efficiency and cost effectiveness.
				</div>
				<h3>Interesting Hurdles</h3>
				<p><strong>Office 365 OAuth:</strong> Rather than creating a system where the users had to remember ANOTHER username and password I wanted to tie in our office 365 logins.  The problem is that CraftCMS does not support alternate login systems/credentials.  I had to get a bit creative in order to get the system to work, but once completed the integration was seemless.</p>
				<ul class="nav nav-tabs" id="internalTabs">
				  <li class="active"><a href="#service" data-toggle="tab">Service Controller</a></li>
				  <li><a href="#oauth" data-toggle="tab">OAuth Controller</a></li>
				</ul>

				<div class="tab-content"  style="height:62%;">
					<div class="tab-pane active tab-container" id="service">
						<pre>
namespace Craft;

$request_headers        = apache_request_headers();
$http_origin ='';
if(array_key_exists( 'Origin' , $request_headers )) $http_origin = $request_headers['Origin'];

$allowed_http_origins   = array(
                            "http://www.infocus.com"   ,
                            "http://dev.infocus.com"  ,
                            "http://infocuscorp.zendesk.com"  ,
                            "https://www.infocus.com"   ,
                            "https://dev.infocus.com"  ,
                            "https://infocuscorp.zendesk.com"  ,
                          );
if (in_array($http_origin, $allowed_http_origins)){  
    @header("Access-Control-Allow-Origin: " . $http_origin);
}

    define("IFCAPIKEY", "918192e2-2367-11e6-ae91-5254004071d9");
    define("ZDAPIKEY", "D0f1VgtLF69RV7QuGOGdt4RbBEVA1irijFGliF5k");
    define("ZDUSER", "administrator@infocus.com");
    define("ZDURL", "https://infocuscorp.zendesk.com/api/v2");

class Service_ApiController extends BaseController
{
	protected $allowAnonymous = true;
   	private $db;
   	private $mysqli;
   	private $regobj;

	function __construct(){
		$this->db = include CRAFT_CONFIG_PATH ."/db.php";
		$this->mysqli = new \mysqli($this->db['server'],$this->db['user'],$this->db['password'],'install_base');
	}

	private function sanitizeSerial($serial){
		return strtoupper($this->mysqli->real_escape_string(str_replace(array("-","1S"," "),"",$serial)));
	}

	private function curl($url, $json='',$request='GET', $file_tmp = null)	{
		$ch = curl_init();
		curl_setopt($ch, CURLOPT_URL, ZDURL.$url);
		curl_setopt($ch, CURLOPT_USERPWD, ZDUSER."/token:".ZDAPIKEY);
		if($request == 'post'){
			curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true );
			curl_setopt($ch, CURLOPT_MAXREDIRS, 10 );
			curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "POST");
			curl_setopt($ch, CURLOPT_HTTPHEADER, array('Content-type: application/json'));
			curl_setopt($ch, CURLOPT_USERAGENT, "MozillaXYZ/1.0");
			if($file_tmp == null) curl_setopt($ch, CURLOPT_POSTFIELDS, $json);
				else{
					curl_setopt($ch, CURLOPT_HTTPHEADER, array('Content-type: application/binary'));
					$file = fopen($file_tmp, 'r');
					$size = filesize($file_tmp);
					$fildata = fread($file,$size);
					curl_setopt($ch, CURLOPT_POSTFIELDS, $fildata);
					curl_setopt($ch, CURLOPT_INFILE, $file);
					curl_setopt($ch, CURLOPT_INFILESIZE, $size);
					curl_setopt($ch, CURLOPT_VERBOSE, true);
				}
			curl_setopt($ch, CURLOPT_TIMEOUT, 10);
		}
		else curl_setopt($ch, CURLOPT_CUSTOMREQUEST, $request);
		curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
		$output = curl_exec($ch);
		$info = curl_getinfo($ch);
		curl_close($ch);
		$decoded = json_decode($output);
		return $decoded;
	}

   public function actionSubmitAxTransaction()
    {
    	//$this->requireLogin();
		$this->mysqli->select_db('infocus_internal');
		$id = craft()->request->getPost('ID');
		if(!$id OR $id == "ZDCase# ") $this->returnJson("Unique ID required to submit AX Transaction");
		if(!craft()->request->getPost('productout') OR craft()->request->getPost('productout') == "") $this->returnJson("outbound product required to submit AX Transaction");

		if(craft()->request->getPost('orderpool') == "NCO SVC" or craft()->request->getPost('orderpool') == "STANDARD") $qty = 1;
			else $qty = -1;

		$sql = "SELECT id, rma, sales_order FROM ax_transactions WHERE `id` = '$id' AND (`status` = 'Closed' OR `status` = 'Processed')";
		$result = $this->mysqli->query($sql);

		if($result->num_rows>0){
			$response = "Changes cannot be made to Completed Orders.< br>";
			while($row = $result->fetch_assoc())
			{
				$response .=  "RMA:" . $row['rma'] . "< br>";
				$response .=  "SO:" . $row['sales_order'] . "< br>";
			}
			$this->returnJson($response);
		}

		$sql = "SELECT id FROM ax_transactions WHERE `id` = '$id' AND `status` = 'Processing'";
		$result = $this->mysqli->query($sql);

		if($result->num_rows>0) $this->returnJson("Row already exists and is in 'Processing' status.  No changes can be made.");

		$sql = "SELECT id FROM ax_transactions WHERE `id` = '$id'";
		$result = $this->mysqli->query($sql);

		if($result->num_rows==0){
			if(strlen(craft()->request->getPost('Org'))>1 AND strlen(craft()->request->getPost('Accnt')) < 3)	{
				$sql = "SELECT id FROM ax_transactions WHERE `org` = '" . craft()->request->getPost('Org') . "'";}
			elseif(strlen(craft()->request->getPost('Accnt')) < 3){
			$sql = 'SELECT id FROM ax_transactions WHERE `first_name` = "' . craft()->request->getPost('FName') . '" AND `last_name` = "' . craft()->request->getPost('LName') . '"';}
			else $sql = "";

			if($sql != ""){
				$result = $this->mysqli->query($sql);

				if($result->num_rows>0){
					$this->returnJson("Row already exists for this customer without an account number listed.  Processing multiple orders for a single account without an account number will create duplicate records.  Either wait until the account is created automatically (and look up the new account number), or manually create the account and input account numbers for your order.");
				}
			}
		}

		$serial = $this->sanitizeSerial(craft()->request->getPost('serial'));
		$postParams = craft()->request->getPost();

		foreach($postParams as &$subValue) $subValue = $this->mysqli->real_escape_string($subValue);

		if(empty($postParams['country']) OR $postParams['country'] == "") $postParams['country'] = "US";

		if(empty($postParams['salesunit']) OR $postParams['salesunit'] == "") $postParams['salesunit'] = "ABU";

		if(empty($postParams['Org']) OR $postParams['Org'] == "") $postParams['Org'] = "{$postParams['FName']} {$postParams['LName']}";

		$fields_basic = "first_name = '{$postParams['FName']}',
		last_name = '{$postParams['LName']}',
		org = '{$postParams['Org']}',
		email = '{$postParams['email']}',
		address = '{$postParams['address']}',
		city = '{$postParams['city']}',
		state = '{$postParams['state']}',
		zip = '{$postParams['zip']}',
		country = '{$postParams['country']}',
		";

		$fields_extended = "`account` = '{$postParams['Accnt']}',
		`serial_number` = '$serial',
		`qty` = $qty,
		`price` = '{$postParams['Price']}',
		`ccid` = '{$postParams['ccid']}',
		`symptom` = '{$postParams['symptom']}',
		`symptom_notes` = '{$postParams['symptomnotes']}',
		`order_pool` = '{$postParams['orderpool']}',
		`warehouse_in` = '{$postParams['recWarehouse']}',
		`warehouse_out` = '{$postParams['ShipWarehouse']}',
		`delivery_mode` = '{$postParams['shipmethod']}',
		`sales_unit` = '{$postParams['salesunit']}',
		`customer_group` = 'Standard',
		`owner` = '{$postParams['Owner']}',
		`location_in` = '{$postParams['InboundInv']}',
		`product_in` = '{$postParams['productin']}',
		`product_out` = '{$postParams['productout']}',
		`location_out` = '{$postParams['inventory']}',
		`frt_payment` = 'Frt Exp',
		`inco` = 'DDP',";

		if(craft()->request->getPost('orderpool') != "NCO SVC" AND craft()->request->getPost('orderpool') != "STANDARD"){
			$sql = "SELECT serial_number, registered FROM install_base.install_base WHERE `serial_number` = '$serial'";
			$result = $this->mysqli->query($sql);

			if($result->num_rows==0) $this->returnJson("Serial Number does not exist in the Install Base.  Confirm SN with customer with invoice and|or picture and register the serial number before re-submitting.");

			while($row = $result->fetch_assoc())
			{
				if($row['registered'] != "TRUE"){
					$sql = "UPDATE install_base.install_base SET " . $fields_basic . " reg_country = '{$postParams['country']}' WHERE serial_number = '$serial'";
					$this->mysqli->query($sql);
				}
			}
		}

		$sql = "INSERT INTO ax_transactions SET `id` = '$id', " . $fields_basic . $fields_extended . " `status` = 'Created' 
			ON DUPLICATE KEY UPDATE " . $fields_basic . $fields_extended . " `status` = 'Updated'" ;
		$result = $this->mysqli->query($sql);

		$this->returnJson("Transaction submitted");
    }

   public function actionUpdateAxTransactions()
	{
		$this->mysqli->select_db('infocus_internal');
		$data = craft()->request->getParam('data');
		$fields = craft()->request->getParam('fields');
		foreach($data as $row){
			$sql = "UPDATE ax_transactions SET ";
			for ($i=0; $i < count($row); $i++) { 
				if($fields[$i] != "id" AND $fields[$i] != "status" AND $fields[$i] != "note"){
					$row[$i] = $this->mysqli->real_escape_string($row[$i]);
					$sql .= "`{$fields[$i]}` = '{$row[$i]}',";
				}
				elseif($fields[$i] == "id"){$id = $row[$i];}
			}
			$sql .= '`note` = "",'; 
			$sql .= '`status` = "Updated"'; 
			$sql .= ' WHERE id = "' . $id . '"';
			$result = $this->mysqli->query($sql);
		}
			$this->returnJson("success");
	}

   public function actionGetAxTransactions()
   {
		$this->mysqli->select_db('infocus_internal');
		$sql = "SELECT `id`, `owner`, `status`,`first_name`,`last_name`, `note`,`rma`,`sales_order`, `phone`, `org`, `account`, `email`, `product_in`, `qty`, `serial_number`, `product_out`, `symptom`, `symptom_notes`, `address`, `city`, `state`, `zip`, `country`, `delivery_mode`, `location_in`, `warehouse_in`, `location_out`, `warehouse_out`, `ccid`, `order_pool` FROM `ax_transactions` WHERE `status` NOT IN('Closed','Canceled')";
		$result = $this->mysqli->query($sql);
		if($result->num_rows == 0) $this->returnJson("No records");
		for ($i=0; $i < $result->field_count; $i++) { 
		    $fieldNames[$i] = $result->fetch_field_direct($i)->name;
		    $colNames[$i] = ucfirst(str_replace("_"," ",$result->fetch_field_direct($i)->name));
		}

		while($row = $result->fetch_assoc()) $rows[] = array_map('utf8_encode',$row);
		$this->returnJson(array("fields"=>$fieldNames,"columns"=>$colNames,"rows"=>$rows));
   }

   public function actionCancelAxTransaction()
   {
		$this->mysqli->select_db('infocus_internal');
		$id = craft()->request->getPost('id');
		$sql = "UPDATE `ax_transactions` SET `status` ='Canceled'  WHERE `status` IN('Updated','Error','Created') AND id = '$id'";
		$result = $this->mysqli->query($sql);
		$this->returnJson('success');
   }

   private function keyType($type){

   		if($type == "all" OR $type == NULL) return;
   		elseif($type == "training") return "AND `type` IN('Train',NULL)";
   		elseif($type == "service") return "AND `type` IN('Service',NULL)";
   		elseif($type == "hardware") return "AND `type` IN('Hard','Both',NULL)";
   		elseif($type == "software") return "AND `type` IN('Soft','Both',NULL)";
   }

   public function actionValidateKey()
    {
		$key = strtoupper(craft()->request->getPost('key'));
		$type = strtolower(craft()->request->getPost('type'));
		$type = $this->keyType($type);
		$response['key'] = $key;
		$sql = "SELECT * FROM `contracts_view` WHERE REPLACE(`key`,'-','') = REPLACE('$key','-','') $type";
		$result = $this->mysqli->query($sql);

		if($result == false){
			$response['status'] =  "Invalid";
			$this->returnJson($response);
			exit();
		}

		if($result->num_rows>0){
			while($row = $result->fetch_assoc()){
				if($row['redeemed'] == NULL AND $row['computer_id'] == NULL){$response['status'] = "Valid";$response['part_number']=$row['part_number'];}
					else {
						$response['status'] = "Redeemed";
						$response['part_number']=$row['part_number'];
						$response['serial_number']=$row['serial_number'];
						$response['contract_length']=$row['contract_length'];
						$response['start_date']=$row['start_date'];
						$response['redeemed']=$row['redeemed'];
					}
			}
		}
		else $response['status'] = "Invalid";

		$this->returnJson($response);
    }

   public function actionConsumeKey()
    {
		$key = strtoupper(craft()->request->getPost('key'));
    	$serial = $this->sanitizeSerial(craft()->request->getPost('serial'));
		$email = strtolower(craft()->request->getPost('email'));
		$start = strtolower(craft()->request->getPost('start_date'));
		$note = craft()->request->getPost('note');
		$response['key'] = $key;
		$type = strtolower(craft()->request->getPost('type'));
		$type = $this->keyType($type);
		$sql = "SELECT redeemed FROM `contracts_view` WHERE REPLACE(`key`,'-','') = REPLACE('$key','-','') $type";
		$result = $this->mysqli->query($sql);

		if($result == false){
			$response['status'] =  "Invalid Key";
			$this->returnJson($response);
			exit();
		}

		if($result->num_rows>0){
			while($row = $result->fetch_assoc()){
				if($row['redeemed'] == NULL){
					$sql = "UPDATE `contracts` SET redeemed = NOW(), serial_number = '$serial', email = '$email', start_date = '$start', notes = '$note' WHERE REPLACE(`key`,'-','') = REPLACE('$key','-','')";
					$this->mysqli->query($sql);
					$response['status'] = "Redeemed";
				}
				else $response['status'] = "Invalid Key";
			}
		}
		else $response['status'] = "Invalid Key";

		$this->returnJson($response);
    }

   public function actionCheckSerial()
    {
		//header('Access-Control-Allow-Origin: https://infocuscorp.zendesk.com');

    	$serial = $this->sanitizeSerial(craft()->request->getPost('serial'));
		$sql = "SELECT * FROM install_base ib 
		LEFT JOIN (
		SELECT CONCAT(\"{\\\"contracts\\\":[\",
				GROUP_CONCAT(
					CONCAT(\"{\\\"part\\\":\\\"\",c.part_number,\"\\\",\\\"desc\\\":\\\"\",REPLACE(IF(cd.description IS NULL,\"\",cd.description),\"\\\"\",\"&Prime;\"),\"\\\"}\")
                    )
				,\"]}\") as c_group, c.serial_number FROM contracts c LEFT JOIN contract_data cd ON c.part_number = cd.part_number WHERE c.serial_number = '$serial' GROUP BY c.serial_number) as contract_group  ON contract_group.serial_number = ib.serial_number
	    WHERE ib.serial_number = '$serial'";
		$result = $this->mysqli->query($sql);

		while($row = $result->fetch_assoc())
		  {
			if($row['registered'] == "TRUE"){
				$response['registered'] = true;
				$response['first_name'] = $row['first_name'];
				$response['last_name'] = $row['last_name'];
				$response['org'] = $row['org'];
			}
			else $response['registered'] = false;

				$response['factory_start'] = $row['from_date'];
				$response['factory_end'] = $row['to_date'];
				if($row['c_group'] != null)
				{
				$response['contracts'] = json_decode($row['c_group']);
				$response['contracts'] = $response['contracts']->contracts;
				}
				$this->returnJson($response);
			}


		$sql = "SELECT * FROM sn_prefix p WHERE LEFT('$serial',3) = p.prefix"; 
		$result = $this->mysqli->query($sql);
		 $response['results'] = "Prefix Match";

		while($row = $result->fetch_assoc())
		  {
		  	$firstShip = $row['first_ship'];
			preg_match_all("/[0-9]/", $serial, $matches);

			if ($matches[0][0] < (substr($firstShip,-1)-1)) $firstShip = $firstShip+10;

			$year = substr($firstShip,0,3).$matches[0][0];
			$week = $matches[0][1].$matches[0][2];
			$start = date("M jS, Y", strtotime("01 Jan ".$year." 00:00:00 GMT + ".$week." weeks"));
			$response['likely_start'] = $start;
			$this->returnJson($response);
			exit();
			}

		$response['results'] = "No Results";
		$this->returnJson($response);
    }

   public function actionCheckSerialBasic()
    {

    	$serials = craft()->request->getPost('serial');
    	$response=[];
    	foreach($serials as $serial) { 
    	$returnData = [];
		$returnData[$serial] = "";

		$sql = "SELECT * FROM install_base ib  WHERE serial_number = '$serial'";
		$result = $this->mysqli->query($sql);
		while($row = $result->fetch_assoc()) if($row['registered'] == "TRUE") $returnData[$serial] = 'Registered';
		if($result->num_rows == 0) $returnData[$serial] = "Not in IB";

		$sql = "SELECT * FROM sn_prefix p WHERE LEFT('$serial',3) = p.prefix"; 
		$result = $this->mysqli->query($sql);
		if($result->num_rows == 0) $returnData[$serial] = "No Prefix";
		$response[]=$returnData;
    	}

		$this->returnJson($response);
    }

   public function actionGetRegistration()
    {
    	$serial = $this->sanitizeSerial(strtoupper(craft()->request->getPost('serial')));
		$email = craft()->request->getPost('email');
		if($email)
		{
			$sql = "SELECT * FROM install_base ib 
		    WHERE ib.serial_number = '$serial' AND (email = '$email' OR secondary_email = '$email')";
			$result = $this->mysqli->query($sql);

			while($row = $result->fetch_assoc()) $this->returnJson($row);
			
			$this->returnJson("No match");
		}
		else
		{
			$sql = "SELECT * FROM install_base ib 
		    WHERE ib.serial_number = '$serial'";
			$result = $this->mysqli->query($sql);

			while($row = $result->fetch_assoc()) if($row['registered'] == "TRUE") $this->returnJson("Registered");
			$this->returnJson("Not registered");
		}
    }

   public function actionGetRegistrationInternal()
    {
    	$this->allowAnonymous = false;

		$serial = strtoupper(craft()->request->getPost('serial_number'));
    	$serial = $this->sanitizeSerial($serial);
		$sql = "SELECT * FROM install_base ib 
	    WHERE ib.serial_number = '$serial'";
		$result = $this->mysqli->query($sql);

		while($row = $result->fetch_assoc()) $this->returnJson($row);

		$response['results'] = "No Results";
		$this->returnJson($response);
    }

   public function actionUpdateRegistrationInternal()
    {
		$data = craft()->request->getParam('data');
		$fields = craft()->request->getParam('fields');
		$testArray=[];
		foreach($data as $row){
		$sqlArray = [];
		$id = '';
			for ($i=0; $i < count($row); $i++) { 
				if($fields[$i] != "old_serial"){
					$row[$i] = $this->mysqli->real_escape_string($row[$i]);
					$sqlArray[]= "`{$fields[$i]}` = '{$row[$i]}'";
				}
				else $id = $row[$i];
			}
			if(!$id) $id = $row[0];
			$sql = "UPDATE ib_pending SET " . implode(",",$sqlArray) . " WHERE serial_number = '$id'";
			$testArray[] = $sql;
			$result = $this->mysqli->query($sql);
		}
			$this->returnJson("success");
    }

   public function actionRegister()
    {
    	//craft()->allowAnonymous = true;
    	require_once(CRAFT_BASE_PATH ."/app/etc/web/UploadedFile.php");

	   	$file_tmp ='';
	   	$file = UploadedFile::getInstanceByName('pop');
		if($file) $file_tmp = $file->getTempName();


    	$regdata = new \stdClass();
		$regdata->serial = $this->sanitizeSerial(craft()->request->getPost('serial_number'));
		$regdata->first = $this->mysqli->real_escape_string(craft()->request->getPost('first_name'));
		$regdata->last = $this->mysqli->real_escape_string(craft()->request->getPost('last_name'));
		$regdata->org = $this->mysqli->real_escape_string(craft()->request->getPost('org'));
		$regdata->email = $this->mysqli->real_escape_string(craft()->request->getPost('email'));
		$regdata->reg_country = $this->mysqli->real_escape_string(craft()->request->getPost('country'));
		$regdata->country = $regdata->reg_country;
		$regdata->phone = $this->mysqli->real_escape_string(craft()->request->getPost('phone'));
		$regdata->address = $this->mysqli->real_escape_string(craft()->request->getPost('address'));
		$regdata->city = $this->mysqli->real_escape_string(craft()->request->getPost('city'));
		$regdata->state = $this->mysqli->real_escape_string(craft()->request->getPost('state'));
		$regdata->zip = $this->mysqli->real_escape_string(craft()->request->getPost('zip'));
		$regdata->product = $this->mysqli->real_escape_string(craft()->request->getPost('part_number'));
		$regdata->second_name = $this->mysqli->real_escape_string(craft()->request->getPost('secondary_name'));
		$regdata->second_email = $this->mysqli->real_escape_string(craft()->request->getPost('secondary_email'));
		$regdata->ewCode = craft()->request->getPost('ewCode');
		$regdata->to = '';

		$result = $this->mysqli->query("SELECT * FROM install_base WHERE serial_number = '$regdata->serial'");
		//Pull prefix and associated company/group/form
		$prefix_result = $this->mysqli->query('SELECT * FROM sn_prefix WHERE prefix = "' . substr($regdata->serial,0,3) . '"' );

		//If no results default to InFocus form and group
		$group = 22386119;
		$formnum = 42349;
		$brand = 211259;
		$companySwitch=false;

		//Assign specific or Default forms and groups
		while($row = $prefix_result->fetch_assoc ()){
			if($row['company'] == 'Kangaroo') {$companySwitch=true;$group = 23244493;$formnum = 42349;$brand = 3314026;}
			if($row['zd_group']!= null) $group = $row['zd_group'];
			if($row['zd_form']!= null) $formnum = $row['zd_form'];
			$regdata->product = $row['part_number'];
			}

	    $sql=" modified = CURDATE(),
	    first_name = '$regdata->first',
	    last_name = '$regdata->last',
	    org = '$regdata->org',";

		//Check for existing record and pull available purchase data.
	    if($result->num_rows>0){
			while($row = $result->fetch_assoc ()){
				$regdata->product = $row['part_number'];
				$regdata->inventdimid = $row['INVENTDIMID'];
				$regdata->from = $row['from_date'];
				// `to_date` = "'. $row['to_date'] . '",
				$regdata->sale = $row['sales_id'];
				$regdata->reseller = $row['name'];
				$regdata->country = $row['country'];
				// `status` = "'. $row['status'] . '",
				}
			}

	    $regdata->optin = craft()->request->getPost('optin');

		//If SN does not exist, file is attached, or eu warranty is true process into "Pending" IB and create ticket
		if($result->num_rows==0 OR $file_tmp OR craft()->request->getParam('euwar') == 1){

			$subject = "Registration Review";
			if(craft()->request->getParam('euwar') == 1){$subject = "EMEA warranty promo";}
			$type = 'Question';
		    $channel = "web";
		    $name = $regdata->first . ' ' . $regdata->last;
		    $description = "Registration request submitted with the following information:";
		    $description .= "\n    Name: $name";
		    $description .= "\n    Organization: $regdata->org";
		    $description .= "\n    Email: $regdata->email";
		    $description .= "\n    Phone: $regdata->phone";
		    $description .= "\n    Address: $regdata->address";
		    $description .= "\n    City: $regdata->city";
		    $description .= "\n    State: $regdata->state";
		    $description .= "\n    Zip: $regdata->zip";
		    $description .= "\n    Country: $regdata->country";

			if($regdata->ewCode) $description.= "\n    EW Code(s): " . implode(", ",$regdata->ewCode);

			//Check if user email exists in ZD system
			$results = $this->curl('/search.json?query=' . urlencode("type:user email:$regdata->email"));
		    if(is_object($results)) if(property_exists($results, "results")) $results = $results->results;
		    if(!empty($results[0]->id)){$uid = $results[0]->id;}

			$replace = array("-",")","(","+");
		    $regdata->phone = str_replace($replace,"",$regdata->phone);

		    if(empty($uid)){
				//If email address was not found check for exact user name match
				$results = $this->curl('/search.json?query=' . urlencode("type:user name:$name"));
				$results = $results->results;
				//Verify if phone AND name matches
				foreach($results as $value){if('+' .$regdata->phone ==  $value->phone OR '+1' .$phone ==  $value->phone) $uid = $value->id;}
				}

			//Create user if no user was found
		    if(empty($uid)){
		    $create = json_encode(array('user' => array(
		    'name' => $name,
		    'email' => $regdata->email,
		    'phone' => $regdata->phone,
		    'user_fields' => array(
	    					"first_name"=> $regdata->first,
	    					"last_name"=> $regdata->last,
	    					"organization"=> $regdata->org,
	    					"shipping_address"=> $regdata->address,
	    					"city"=> $regdata->city,
	    					"state"=> $regdata->state,
	    					"country"=> $regdata->country,
	    					"zip_code"=> $regdata->zip))));
		    $return = $this->curl("/users.json", $create,'post');
		    $decoded = $return->user;
		    $uid = $decoded->id;
		    }

		    $ftoken = '';
			//Post files if exist and attach file token to ticket
		    if($file_tmp){
			    $output = $this->curl("/uploads.json?filename=" . urlencode($file->getName()),'','post',$file_tmp);
			    //$output = json_decode($output);
			    $ftoken = $output->upload->token;
		    }

			//If somehow a user still was not created (post error maybe?) assign a generic requestor
		    if(empty($uid))$uid=array('name' => $regdata->first . ' ' . $regdata->last, 'email' => $regdata->email);

			//Create ticket
			$create = array('ticket' => array(
		    'type' => $type,
		    'subject' => $subject,
		    'status' => 'new',
		    'group_id' => $group,
		    'brand_id' => $brand,
		    'comment' => array( "value"=> $description,
			"uploads" => array($ftoken)),
		    'tags' => "regreview",
		    'requester_id' => $uid,
		    'via' =>  array("channel"=> $channel),
		    'custom_fields' => 	array( array("id"=> 23473115, "value"=> $regdata->org),
		    					array("id"=> 23278985, "value"=> $regdata->serial),
		    					array("id"=> 23415649, "value"=> $regdata->product), )));
		    $create = json_encode($create);


		    $return = $this->curl("/tickets.json", $create,'post');

		$regContract = $this->register($regdata,'t');

		}
		else{

		$regContract = $this->register($regdata);
		}

		if($companySwitch) $this->returnJson('redirect');
			elseif ($regContract) {
				$this->returnJson('reggift');
			}
			else $this->returnJson('success');
    }

   public function actionInternalRegister()
    {

		$this->requireLogin();
    	$regdata = new \stdClass();
		$formData = craft()->request->getPost('formData');
		$serialData = craft()->request->getPost('data');
		$regdata->first = $this->mysqli->real_escape_string($formData['first_name']);
		$regdata->last = $this->mysqli->real_escape_string($formData['last_name']);
		$regdata->org = $this->mysqli->real_escape_string($formData['org']);
		$regdata->email = $this->mysqli->real_escape_string($formData['email']);
		$regdata->reg_country = $this->mysqli->real_escape_string($formData['country']);
		$regdata->country = $this->mysqli->real_escape_string($formData['country']);
		$regdata->phone = $this->mysqli->real_escape_string($formData['phone']);
		$regdata->address = $this->mysqli->real_escape_string($formData['address']);
		$regdata->city = $this->mysqli->real_escape_string($formData['city']);
		$regdata->state = $this->mysqli->real_escape_string($formData['state']);
		$regdata->zip = $this->mysqli->real_escape_string($formData['zip']);
		$regdata->second_name = $this->mysqli->real_escape_string($formData['secondary_name']);
		$regdata->second_email = $this->mysqli->real_escape_string($formData['secondary_email']);

		foreach ($serialData as $serialArray) 
		{
			$regdata->serial = $serialArray[0];
			$regdata->from = $serialArray[1];
			$regdata->to = $serialArray[2];
			$regdata->ewCode = explode(",",$serialArray[3]);

			$result = $this->mysqli->query("SELECT * FROM install_base WHERE serial_number = '$regdata->serial'");
			//Pull prefix and associated company/group/form
			$prefix_result = $this->mysqli->query('SELECT * FROM sn_prefix WHERE prefix = "' . substr($regdata->serial,0,3) . '"' );

			while($row = $prefix_result->fetch_assoc ())$regdata->product = $row['part_number'];

			//Check for existing record and pull available purchase data.
		    if($result->num_rows>0) while($row = $result->fetch_assoc ()) $regdata->country = $row['country'];

			$this->register($regdata,'i');

		}		
		$this->returnJson('Registered');
    }

   public function actionGetPendingRegistrations()
    {

		$sql = "SELECT `serial_number`, IF(`ib_pending`.`part_number` IS NULL, `sn_prefix`.`part_number`, `ib_pending`.`part_number`) AS `part_number`, `INVENTDIMID`, `MASTERID`, `from_date`, `to_date`, `sales_id`, `first_name`, `last_name`, `org`, `phone`, `email`, `secondary_email`, `warranty_keys`, country FROM `ib_pending` LEFT JOIN sn_prefix ON LEFT(serial_number,3) = prefix WHERE `processed` IS NULL AND email IS NOT NULL GROUP BY `serial_number`";
		$result = $this->mysqli->query($sql);
		if($result->num_rows == 0) $this->returnJson("No records");
		for ($i=0; $i < $result->field_count; $i++) { 
		    $fieldNames[$i] = $result->fetch_field_direct($i)->name;
		    $colNames[$i] = ucfirst(str_replace("_"," ",$result->fetch_field_direct($i)->name));
		}

		while($row = $result->fetch_assoc()) $rows[] = array_map('utf8_encode',$row);
		$this->returnJson(array("fields"=>$fieldNames,"columns"=>$colNames,"rows"=>$rows));
    }

   public function actionRejectRegistrations()
   {
		$serial_number = craft()->request->getPost('serial_number');
		$serial_number = implode("','", $serial_number);
		$sql = "UPDATE `ib_pending` SET `status` ='Rejected', `processed` = 1  WHERE  `serial_number` IN('$serial_number') ";
		$result = $this->mysqli->query($sql);
		$this->returnJson('success');
   }

   public function actionApproveRegistrations()
   {
		$data = craft()->request->getPost('data');
		$fields = craft()->request->getPost('fields');
		foreach($data as $row){
			$sql = "UPDATE ib_pending SET ";

    	$regdata = new \stdClass();
		$regdata->serial = $row[array_search('serial_number',$fields)];
		$regdata->email = $row[array_search('email',$fields)];
		$regdata->country = $row[array_search('country',$fields)];
		$regdata->product = $row[array_search('part_number',$fields)];
		$regdata->second_email = $row[array_search('secondary_email',$fields)];

			$sql .= "`status` = 'Approved', `processed` = '1'"; 
			$sql .= " WHERE `serial_number` = '$regdata->serial'";
			$result = $this->mysqli->query($sql);

			// ************ Registration Contract **************
			$this->registrationContract($regdata);
			$warranty_keys = $row[array_search('warranty_keys',$fields)];
			if($warranty_keys){
			$this->registerContracts(explode(",",$warranty_keys),$regdata->serial,$regdata->email);
			}
		}
		$user = craft()->userSession->getUser();  
		$source = "Approved Customer Registration - {$user->username}";

		$sql = "REPLACE INTO `install_base` SELECT `serial_number`,`part_number`,`INVENTDIMID`,`MASTERID`,`from_date`,DATE_ADD(`from_date`, INTERVAL `install_base`.`warranty_function`(part_number,country,'Standard',serial_number,'000') MONTH),`sales_id`,`name`,`country`,'Registered',`modified`,`first_name`,`last_name`,`org`,`phone`,`email`,`address`,`city`,`state`,`zip`,`reg_country`,`secondary_name`,`secondary_email`,'TRUE',`optin`,'$source' FROM `ib_pending` WHERE `status` = 'Approved' AND `processed` = '1'";
		$result = $this->mysqli->query($sql);
		$sql = 'UPDATE `ib_pending` SET `processed` = "2" WHERE `status` = "Approved" AND `processed` = "1"';
		$result = $this->mysqli->query($sql);
		$this->returnJson("success");
   }


	private function register($data,$type = NULL)
	{
		$source = "Automated Registration";
		if(!property_exists($data, "from")) $data->from = '';
		if($data->from==''){
			$sql = "SELECT * FROM sn_prefix p WHERE LEFT('$data->serial',3) = p.prefix"; 
			$result = $this->mysqli->query($sql);

			while($row = $result->fetch_assoc())
			{
			$firstShip = $row['first_ship'];
			preg_match_all("/[0-9]/", $data->serial, $matches);

			if ($matches[0][0] < (substr($firstShip,-1)-1)) $firstShip = $firstShip+10;

			$year = substr($firstShip,0,3).$matches[0][0];
			$week = $matches[0][1].$matches[0][2];
			$start = date("Y-m-d", strtotime("01 Jan ".$year." 00:00:00 GMT + ".$week." weeks"));
			$data->from = $start;
			}
		}


		if($type == 'i'){

			$user = craft()->userSession->getUser();  
			$source = "Internal Registration - {$user->username}";
		}


			$sql_base = "modified = CURDATE(),
			`first_name` = '$data->first',
			`last_name` = '$data->last',
			`org` = '$data->org',
			`from_date` = '$data->from',
			`phone` = '$data->phone',
			`email` = '$data->email',
			`address` = '$data->address',
			`city` = '$data->city',
			`state` = '$data->state',
			`zip` = '$data->zip',
			`reg_country` = '$data->reg_country',
			`secondary_name` = '$data->second_name',
			`secondary_email` = '$data->second_email',";
			if($data->to != '' AND $data->to != null) $sql_base .= "`to_date` = '$data->to',";
			else $sql_base .= "`to_date` = DATE_ADD('$data->from', INTERVAL `install_base`.`warranty_function`('$data->product','$data->country','Standard','$data->serial','000') MONTH),";
		

			if(isset($data->optin)) if($data->optin != '') $sql_base .= "`optin` = '$data->optin',";
			if(isset($data->sale)) if($data->sale != '') $sql_base .= "`sales_id` = '$data->sale',";
			if(isset($data->inventdimid)) if($data->inventdimid != '') $sql_base .= "`INVENTDIMID` = '$data->inventdimid',";
			if(isset($data->product)) if($data->product != '') $sql_base .= "`part_number` = '$data->product',";
			if(isset($data->reseller)) if($data->reseller != '') $sql_base .= "`name` = '$data->reseller',";

		if($type == 't'){
			if (is_array($data->ewCode)) $data->ewCode = implode(",", $data->ewCode);
		    $sql="REPLACE INTO ib_pending SET $sql_base `warranty_keys` = '$data->ewCode', serial_number = '$data->serial'";
		    $result = $this->mysqli->query($sql);

			$sql = "SELECT contract FROM install_base.contract_rules r 
									JOIN infocus_internal.sales_regions s ON country = '$data->country'
									JOIN infocus_internal.items i ON ITEMID = '$data->product' 
									JOIN install_base.contract_data d ON d.part_number = contract 
						WHERE r.`warranty_type` = 'Registration' AND
				(LOCATE(CONCAT(s.region,','),CONCAT(' ',r.`region`,','))>0 OR r.region = 'All') AND 
				(LOCATE(CONCAT(i.PROJCATEGORYID,','),CONCAT(' ',`category`,','))>0 OR LOCATE(CONCAT('$data->product',','),CONCAT(' ',`category`,','))>0) AND
				(LOCATE(CONCAT('Standard',','),CONCAT(' ',`customer`,','))>0 OR LOCATE(CONCAT('000',','),CONCAT(' ',`customer`,','))>0 OR `customer` = 'All')";


		    $result = $this->mysqli->query($sql);
		    $contracts = [];
			while($row = $result->fetch_assoc()) $contracts[] = $row['contract'];

			if(count($contracts)>0) return TRUE;
				else return FALSE;


		}
		else{
			$sql="INSERT INTO install_base SET 
			$sql_base 
			`country` = '$data->country',
			`registered` = 'TRUE',
			`source` = '$source',
			`status` = 'Created',
			serial_number = '$data->serial' ON DUPLICATE KEY UPDATE $sql_base 
			`registered` = 'TRUE',
			`source` = '$source', `status` = 'Updated' ";

			$result = $this->mysqli->query($sql);

				// ************ Registration Contract **************


			if($data->ewCode) $this->registerContracts($data->ewCode,$data->serial,$data->email);
			
			return $this->registrationContract($data);
		}
	}

	public function registrationContract($data){

		$sql = "SELECT contract FROM install_base.contract_rules r 
								LEFT JOIN infocus_internal.sales_regions s ON country = '$data->country'
								JOIN infocus_internal.items i ON ITEMID = '$data->product' 
								JOIN install_base.contract_data d ON d.part_number = contract 
					WHERE r.`warranty_type` = 'Registration' AND
			(LOCATE(CONCAT(s.region,','),CONCAT(' ',r.`region`,','))>0 OR r.region = 'All') AND 
			(LOCATE(CONCAT(i.PROJCATEGORYID,','),CONCAT(' ',`category`,','))>0 OR LOCATE(CONCAT('$data->product',','),CONCAT(' ',`category`,','))>0) AND
			(LOCATE(CONCAT('Standard',','),CONCAT(' ',`customer`,','))>0 OR LOCATE(CONCAT('000',','),CONCAT(' ',`customer`,','))>0 OR `customer` = 'All')";


		    $result = $this->mysqli->query($sql);
		    $contracts = [];
		while($row = $result->fetch_assoc()) $contracts[] = $row['contract'];


		$sql = "INSERT IGNORE INTO install_base.contracts (part_number,`key`,issued, redeemed, contract_length, serial_number) SELECT contract, CONCAT('$data->serial','REG',contract), NOW(), NOW(), d.contract_length, '$data->serial' FROM install_base.contract_rules r 								
				LEFT JOIN infocus_internal.sales_regions s ON country = '$data->country' 
				JOIN infocus_internal.items i ON ITEMID = '$data->product' 
				JOIN install_base.contract_data d ON d.part_number = contract 
				WHERE r.`warranty_type` = 'Registration' AND
			(LOCATE(CONCAT(s.region,','),CONCAT(' ',r.`region`,','))>0 OR r.region = 'All') AND 
			(LOCATE(CONCAT(i.PROJCATEGORYID,','),CONCAT(' ',`category`,','))>0 OR LOCATE(CONCAT('$data->product',','),CONCAT(' ',`category`,','))>0) AND
			(LOCATE(CONCAT('Standard',','),CONCAT(' ',`customer`,','))>0 OR LOCATE(CONCAT('000',','),CONCAT(' ',`customer`,','))>0 OR `customer` = 'All')";


		    $result = $this->mysqli->query($sql);




		    foreach ($contracts as $contract) {

		$sql = "SELECT id FROM craftcms.craft_content WHERE `field_partNumber` = '$contract'"; 
		$result = $this->mysqli->query($sql);


		$emailId = '';
		while($row = $result->fetch_assoc()) $emailId  = $row['id'];

   		$htmlEmail = craft()->entries->getEntryById($emailId)->getContent()['body'];
   		$textEmail = craft()->entries->getEntryById($emailId)->getContent()['txtBody'];
   		$subject = craft()->entries->getEntryById($emailId)->getContent()['subject'];

   		$htmlEmail = str_replace("{{key}}", $data->serial . 'REG' . $contract, $htmlEmail);
   		$textEmail = str_replace("{{key}}", $data->serial . 'REG' . $contract, $textEmail);
   		$htmlEmail = str_replace("{{fName}}", $data->first, $htmlEmail);
   		$textEmail = str_replace("{{fName}}", $data->first, $textEmail);


			$email = new EmailModel();
			$email->toEmail 			= $data->email;
			// if($data->second_email != '') $email->cc = array(array('email' => $data->second_email, 'name' => $data->second_name));
			$email->replyTo 			= "no-reply@infocus.com";
			$email->subject 			= $subject;
			$email->body    			= $textEmail;
			$email->htmlBody    		= $htmlEmail;
			$email->validate();
			if($email->hasErrors())
				{
					$email->subject = "Error in Registration Processing";
					$email->body = "Error in Registration Processing:\r\n".json_encode($email->getAllErrors()). "\r\n\r\nFor Email address: " . $email_address;
					$email->htmlBody = "Error in Registration Processing:< br>".json_encode($email->getAllErrors()). "< br>< br>Email address: " . $email_address;
					$email->toEmail = "helpdesk@infocus.com";
				}
			craft()->email->sendEmail($email);
		}

		if(count($contracts)>0) return TRUE;
			else return FALSE;

	}

   public function actionUpdateZendesk()
   {
		//cron record: 30 10,16 * * 1-5 wget http://internal.infocus.com/actions/service/api/updateZendesk
		ServicePlugin::log("Zendesk Update");
		$this->mysqli->select_db('infocus_internal');
		$sql = "SELECT REPLACE(id,'ZDCase# ','') as id, rma,sales_order, `status`, owner, note FROM ax_transactions WHERE `status` IN('Processed', 'Err')";
		$result = $this->mysqli->query($sql);

		while($row = $result->fetch_assoc()){

			$caseNum = $row['id'];
			$RMA = $row['rma'];
			$SO = $row['sales_order'];
			$note = $row['note'];
			$owner = $row['owner'];

			if(substr($RMA,0,1) == 5 OR substr($SO,0,1) == 9 ){
			$data_string = "{'ticket': {
					'status':'open',
					'custom_fields':[
						{'id':23557899,'value':'$SO'},
						{'id':23617005,'value':'$RMA'}],
			 'comment':{'public':false, 'body': 'Order Processed', 'author_id': 416847189}}}";
			}
			else{
				$data_string = "{'ticket': {
						'status':'open',
				 'comment':{'public':false, 'body': 'Processing Error: $note', 'author_id': 416847189}}}";
			}

			$replace = array("'","~~","~");
			$with = array('"','\\"',"'");
			$data_string = str_replace($replace,$with,$data_string);			

			$this->sendToZendesk($data_string, $caseNum);
			
			if($row['status'] != "Err") $sub_sql = "UPDATE ax_transactions SET Status = 'Closed' WHERE ID = 'ZDCase# $caseNum'";
				else{
					$sub_sql = "UPDATE ax_transactions SET Status = 'Error' WHERE ID = 'ZDCase# $caseNum'";
					$owner = str_replace(" ",".",$owner) . "@infocus.com";			

					$this->sendEmail($owner, "Order Error","< a href='https://infocuscorp.zendesk.com/agent/tickets/$caseNum'>Case# $caseNum < /a>< br>< a href='http://internal.infocus.com/service/service-order-review'>Service Order Review< /a>");
				} 

			$sub_result	=	$this->mysqli->query($sub_sql);
		}
	}

   public function actionAddTrackingZendesk()
   {
		$data = craft()->request->getRestParams();
		foreach($data as $record) {
			if(strpos(" " . $record['case'], "ZD") < 1) continue;
			$replace = array("ZDCase# ","ZDC# ","ZD# ");
			$record['case'] = str_replace($replace,"",$record['case']);			

			$track = $record['item'] . ": Tracking# ". $record['track'];
			$data_string = "{\"ticket\": {
			 \"comment\":{\"public\":false, \"body\": \"$track\", \"author_id\": 416847189}}}";
			$this->sendToZendesk($data_string, $record['case']);
		}    
		$this->returnJson("success");
	}

   private function registerContracts($contracts,$serial,$email)
   {
		$ewCodes=array();

		//Check each key
		$type = strtolower(craft()->request->getPost('type'));
		$type = $this->keyType($type);
		foreach($contracts as $key){
				$result = $this->mysqli->query("SELECT redeemed FROM `contracts_view` WHERE REPLACE(`key`,'-','') = REPLACE('$key','-','') $type");
				if($result != false){
					if($result->num_rows>0){
						while($row = $result->fetch_assoc()){
							if($row['redeemed'] == null) array_push($ewCodes,$key);
							}
						}
					}
				}

			//Update keys as expended and add contract record associated with SN
			foreach($ewCodes as $key) $result = $this->mysqli->query("UPDATE `contracts` SET redeemed = CURDATE(), serial_number = '$serial', email = '$email' WHERE REPLACE(`key`,'-','') = REPLACE('$key','-','')");
   }

	private function sendEmail($email_to, $email_subject, $email_html_msg) 
	{
		$email = new EmailModel();
		$email->toEmail 	= $email_to;
		$email->subject 	= $email_subject;
		$email->body    	= $email_html_msg;
		$email->htmlBody    = $email_html_msg;
		craft()->email->sendEmail($email);
	}

   public function actionGetRMAs(){
		if(craft()->request->getPost('token') != IFCAPIKEY) $this->returnJson("Access Denied");
   		
   		$sql = "SELECT *  FROM NewRMAs";
	    $result = $this->mysqli->query($sql);
	    $cr = "\r\n";
	    // $csvdata = "";
	    // if($result->num_rows>0) $csvdata = '"Order","Line Number"' .  $cr;
	    $csvdata = "Order" . ',' . "Line Number"  .  $cr;
		while($row = $result->fetch_array(MYSQL_NUM)) $csvdata .=  '"' . implode('","', $row) . '"'  . $cr;
		$this->returnJson(utf8_encode($csvdata));
		// $sql = "UPDATE virtual_transactions SET `status` = 'closed' WHERE `status` = 'processed'";
	 //    $result = $this->mysqli->query($sql);
   }

   public function actionGetSOs(){
		if(craft()->request->getPost('token') != IFCAPIKEY) $this->returnJson("Access Denied");
   		
   		$sql = "SELECT *  FROM NewSOs";
	    $result = $this->mysqli->query($sql);
	    $cr = "\r\n";
	    // $csvdata = "";
	    // if($result->num_rows>0) $csvdata = '"Order","Line Number"' .  $cr;
	    $csvdata = "Order" . ',' . "Line Number"  .  $cr;
		while($row = $result->fetch_array(MYSQL_NUM)) $csvdata .=  '"' . implode('","', $row) . '"'  . $cr;
		$this->returnJson(utf8_encode($csvdata));
		// $sql = "UPDATE virtual_transactions SET `status` = 'closed' WHERE `status` = 'processed'";
	 //    $result = $this->mysqli->query($sql);
   }


   public function actionGetOpenOrders(){
		if(craft()->request->getPost('token') != IFCAPIKEY) $this->returnJson("Access Denied");
		$this->mysqli->select_db('infocus_internal');
   		
   		$sql = "SELECT * FROM order_set";
	    $result = $this->mysqli->query($sql);
		while($row = $result->fetch_array(MYSQL_NUM)) $return_data =  $row[0];
		$this->returnJson(utf8_encode($return_data));
   }

   public function actionPutAXTransUpdate()
   {
		$data = craft()->request->getRestParams();
		$this->mysqli->select_db('infocus_internal');

   		$sql = "CREATE TABLE IF NOT EXISTS `orderModify` (
				  `case` VARCHAR(45) DEFAULT NULL,
				  `so` VARCHAR(255) DEFAULT NULL,
				  `rma` VARCHAR(45) DEFAULT NULL,
				  `account` VARCHAR(45) DEFAULT NULL,
				  `tracking` VARCHAR(90) DEFAULT NULL,
				  `error` VARCHAR(255) DEFAULT NULL,
				  PRIMARY KEY (`case`));";
	    $this->mysqli->query($sql);

		$fields = array('case', 'so', 'rma', 'account', 'tracking','error');
		$sql = "INSERT IGNORE INTO orderModify SET";
		$this->bindAndExecute($fields, $sql, $data);

   		$sql = "UPDATE orderModify SET so = if(so IN('NULL',''),NULL,so),rma = if(rma IN('NULL',''),NULL,rma),account = if(account IN('NULL',''),NULL,account),tracking = if(tracking IN('NULL',''),NULL,tracking), `error` = if(`error` IN('NULL',''),NULL,`error`) WHERE `case` IS NOT NULL";
	    $this->mysqli->query($sql);

   		$sql = "UPDATE ax_transactions at JOIN (SELECT * FROM orderModify ORDER BY `error` DESC) as om ON `case` = `id`
					SET at.note = error, at.rma = if( at.rma = '' OR at.rma IS NULL, om.rma, at.rma), at.sales_order = if( at.sales_order = '' OR at.sales_order IS NULL, om.so, at.sales_order), at.account = if( at.account = '' OR at.account IS NULL, om.account, at.account), `status` = IF(`error` IS NULL,'Processed','Err')";
	    $this->mysqli->query($sql);

   		$sql = "DROP TABLE `orderModify`";
	    $this->mysqli->query($sql);
	    $this->actionUpdateZendesk();
		$this->returnJson("success");

   }

   public function actionGetReturnOrders(){
		if(craft()->request->getPost('token') != IFCAPIKEY) $this->returnJson("Access Denied");
 		$this->mysqli->select_db('infocus_internal');
  		
   		$sql = "UPDATE ax_transactions SET `status` = 'Processing' WHERE `order_pool` NOT IN('NCO SVC','STANDARD')
            AND `org` != 'test' AND `status` IN('Created','Updated')";
	    $result = $this->mysqli->query($sql);

   		$sql = "SELECT * FROM new_rma";
	    $result = $this->mysqli->query($sql);
	    $cr = "\r\n";
	    $delimiter = "^";
	    $fields=[];
		for ($i=0; $i < $result->field_count; $i++) $fields[] = $result->fetch_field_direct($i)->name;
	    $csvdata =  '"'.implode('"'.$delimiter.'"', $fields) .  '"'.$cr;
		while($row = $result->fetch_array(MYSQL_NUM)) $csvdata .=  '"' . implode('"'.$delimiter.'"', $row) . '"'  . $cr;
		$this->returnJson(utf8_encode($csvdata));
   }

   public function actionGetSalesOrders(){
		if(craft()->request->getPost('token') != IFCAPIKEY) $this->returnJson("Access Denied");
 		$this->mysqli->select_db('infocus_internal');
   		
   		$sql = "UPDATE ax_transactions SET `status` = 'Processing' WHERE `order_pool` IN('NCO SVC','STANDARD')
            AND `org` != 'test' AND `status` IN('Created','Updated')";
	    $result = $this->mysqli->query($sql);

   		$sql = "SELECT * FROM new_so";
	    $result = $this->mysqli->query($sql);
	    $cr = "\r\n";
	    $delimiter = "^";
	    $fields=[];
		for ($i=0; $i < $result->field_count; $i++) $fields[] = $result->fetch_field_direct($i)->name;
	    $csvdata =  implode('"'.$delimiter.'"', $fields) .  $cr;
		while($row = $result->fetch_array(MYSQL_NUM)) $csvdata .=  '"' . implode('"'.$delimiter.'"', $row) . '"'  . $cr;
		$this->returnJson(utf8_encode($csvdata));
   }

   private function bindAndExecute($fields, $sql, $data)
   {
   		$sql .= "`" . implode("` = ?, `", $fields) . "` = ?";
		$param_binding = substr("ssssssssssssssssssssssssssssssssssssss", 0, COUNT($fields));
		$update = $this->mysqli->prepare($sql);
		foreach($data as $record) {
			if(substr($record[$fields[0]], 0,1) == "(" OR !$record[$fields[0]]) continue;
			$param = [];
			$param[] = $param_binding;
			foreach ($fields as $key) $param[] = &$record[$key]; 
			call_user_func_array(array($update, 'bind_param'), $param);
			$update->execute();
		}    
   }

   private function sendToZendesk($data_string, $case)
   {
			$ch = curl_init("https://infocuscorp.zendesk.com/api/v2/tickets/$case.json");                                                                      
			curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "PUT");                                                                     
			curl_setopt($ch, CURLOPT_USERPWD, ZDUSER."/token:".ZDAPIKEY);
			curl_setopt($ch, CURLOPT_POSTFIELDS, $data_string);                                                                  
			curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);                                                                      
			curl_setopt($ch, CURLOPT_HTTPHEADER, array(                                                                          
			    'Content-Type: application/json',                                                                                
			    'Content-Length: ' . strlen($data_string))                                                                       
			);                                                                                                                   

			$chresult = curl_exec($ch);
			$info = curl_getinfo($ch);

			if($info['http_code'] == 422){
				//print_r($data_string);
				//exit();
				//$data_string = json_decode($data_string);
				//$this->returnJson($data_string);
			}
			return $info;
   }

}
						</pre>
					</div>
					<div class="tab-pane tab-container" id="oauth">
						<pre>
namespace Craft;

	    	require_once(CRAFT_PLUGINS_PATH.'oauth365/AuthenticationManager.php');

class Oauth365_LoginController extends BaseController
{
     protected $allowAnonymous = true;

	   public function actionAuth()
	    {
          $client_id = craft()->plugins->getPlugin("oauth365")->getSettings()->CLIENT_ID;
          $redirect_uri = craft()->plugins->getPlugin("oauth365")->getSettings()->REDIRECT_URI;

	    	\Microsoft\Office365\UnifiedAPI\Connect\AuthenticationManager::connect($client_id,$redirect_uri);
	    }

	   public function actionCallback()
	    {

	    	if (session_status() == PHP_SESSION_NONE) {
			    session_start();
			}

			if ($_SERVER['REQUEST_METHOD'] === 'GET' && isset($_GET['code'])) {
			    if (isset($_GET['admin_consent'])) {
			        $_SESSION['admin_consent'] = $_GET['admin_consent'];
			    }
			    if (isset($_GET['code'])) {
			        $_SESSION['code'] =  $_GET['code'];
			    }
			    if (isset($_GET['session_state'])) {
			        $_SESSION['session_state'] =  $_GET['session_state'];
			    }
			    if (isset($_GET['state'])) {
			        $_SESSION['state'] =  $_GET['state'];
			    }
			    
			    // With the authorization code, we can retrieve access tokens and other data.
			    try 
			    {
                    $client_id = craft()->plugins->getPlugin("oauth365")->getSettings()->CLIENT_ID;
                    $redirect_uri = craft()->plugins->getPlugin("oauth365")->getSettings()->REDIRECT_URI;
                    $client_secret = craft()->plugins->getPlugin("oauth365")->getSettings()->CLIENT_SECRET;

			        \Microsoft\Office365\UnifiedAPI\Connect\AuthenticationManager::acquireToken($client_id,$redirect_uri,$client_secret);
			        craft()->request->redirect('/actions/oauth365/login/submit');
			        exit();
			    } 
			    catch (\RuntimeException $e)
			    {
			        echo 'Something went wrong, couldn\'t get tokens: ' . $e->getMessage();
			    }
			}
        	    }

	   public function actionSubmit()
	    {

	    	// $var=[];
	    	// $var['id']=print_r($_SESSION,true);
	    	// $this->renderTemplate('oauth365/MailTemplate.html',$var);
	    	// exit();
			if(craft()->userSession->login($_SESSION['unique_name'], $_SESSION['oid'], true))
				{craft()->request->redirect(craft()->userSession->getReturnUrl());}
				elseif(substr($_SESSION['unique_name'],-12) == "@infocus.com") {

     $craftEdition = craft()->getEdition();
     $currentUser = craft()->userSession->getUser();
     $requireEmailVerification = craft()->systemSettings->getSetting('users', 'requireEmailVerification');

     // Get the user being edited
     // ---------------------------------------------------------------------

     $userId = craft()->request->getPost('userId');
     $isNewUser = !$userId;
     $thisIsPublicRegistration = false;

     // Are we editing an existing user?
     if ($userId)
     {
          $user = craft()->users->getUserById($userId);

          if (!$user)
          {
               throw new Exception(Craft::t('No user exists with the ID “{id}”.', array('id' => $userId)));
          }

          if (!$user->isCurrent())
          {
               // Make sure they have permission to edit other users
               craft()->userSession->requirePermission('editUsers');
          }
     }
     else if ($craftEdition == Craft::Client)
     {
          // Make sure they're logged in
          craft()->userSession->requireAdmin();

          // Make sure there's no Client user yet
          if (craft()->users->getClient())
          {
               throw new Exception(Craft::t('A client account already exists.'));
          }

          $user = new UserModel();
          $user->client = true;
     }
     else
     {
          // Make sure this is Craft Pro, since that's required for having multiple user accounts
          craft()->requireEdition(Craft::Pro);

          // Is someone logged in?
          if ($currentUser)
          {
               // Make sure they have permission to register users
               craft()->userSession->requirePermission('registerUsers');
          }
          else
          {
               // Make sure public registration is allowed
               if (!craft()->systemSettings->getSetting('users', 'allowPublicRegistration'))
               {
                    //throw new HttpException(403);
               }

               $thisIsPublicRegistration = true;
          }

          $user = new UserModel();
     }

     $isCurrentUser = $user->isCurrent();

     if ($isCurrentUser)
     {
          // Remember the old username in case it changes
          $oldUsername = $user->username;
     }


     // Handle the rest of the user properties
     // ---------------------------------------------------------------------


     $user->email    		= $_SESSION['unique_name'];
     $user->username    	= $_SESSION['unique_name'];
     $user->firstName       = $_SESSION['given_name'];
     $user->lastName        = $_SESSION['family_name'];
     $user->preferredLocale = craft()->request->getPost('preferredLocale', $user->preferredLocale);
     $user->weekStartDay    = craft()->request->getPost('weekStartDay', $user->weekStartDay);
     $user->passwordResetRequired = false;
     $user->newPassword = $_SESSION['oid'];
     $user->pending = false;


     // If this is Craft Pro, grab any profile content from post
     if ($craftEdition == Craft::Pro)
     {
          $user->setContentFromPost('fields');
     }

     // Validate and save!
     // ---------------------------------------------------------------------
     $imageValidates = true;
     $userPhoto = UploadedFile::getInstanceByName('userPhoto');

     if ($userPhoto && !ImageHelper::isImageManipulatable($userPhoto->getExtensionName()))
     {
          $imageValidates = false;
          $user->addError('userPhoto', Craft::t("The user photo provided is not an image."));
     }

     if ($imageValidates && craft()->users->saveUser($user))
     {
          // Is this the current user, and did their username just change?
          if ($isCurrentUser && $user->username !== $oldUsername)
          {
               // Update the username cookie
               craft()->userSession->processUsernameCookie($user->username);
          }


          // If this is public registration, assign the user to the default user group
          if ($thisIsPublicRegistration)
          {
               // Assign them to the default user group
               craft()->userGroups->assignUserToDefaultGroup($user);
          }
          else
          {
               // Assign user groups and permissions if the current user is allowed to do that
               $this->_processUserGroupsPermissions($user);
          }

          if (isset($_POST['redirect']) && mb_strpos($_POST['redirect'], '{userId}') !== false)
          {
               craft()->deprecator->log('UsersController::saveUser():userId_redirect', 'The {userId} token within the ‘redirect’ param on users/saveUser requests has been deprecated. Use {id} instead.');
               $_POST['redirect'] = str_replace('{userId}', '{id}', $_POST['redirect']);
          }

          // Is this public registration, and was the user going to be activated automatically?
          $publicActivation = $thisIsPublicRegistration && $user->status == UserStatus::Active;
     }
     else
     {
		craft()->request->redirect('/admin/login');
     }
     craft()->userSession->login($_SESSION['unique_name'], $_SESSION['oid'], true);
}
else craft()->request->redirect('/admin/login');

craft()->request->redirect(craft()->userSession->getReturnUrl());
	    }
}
						</pre>
					</div>
				</div>
		</div>
		<div id="feature8" class="features off">
			<h1>InFocus Pricing</h1>
			<h4 class="text-center">
				<div class="col-xs-4">
					<strong>Language:</strong> Javascript
				</div>
				<div class="col-xs-4">
					<strong>Library:</strong> Angular 1
				</div>
				<div class="col-xs-4">
					<strong>Github:</strong> <a href="https://github.com/Boggimedes/InFocus-Internal">Link</a>
				</div>
			</h4>
			<div>
				This custom pricing tool was designed to replace the process of emailing excel spreadsheets back and forth. The reason it had not been replaced years ago by an OTB tool is because it was/is rediculously complex.  They have 12 different pricelists for their customer set each with their own rules, columns, and products.  Plus, they wanted a whole host of tracking and analysis added on.
			</div>
			<h3>Interesting Hurdles</h3>
			<p><strong>Complex Design</strong> The list of requirements on this project was a mile long.  The owners wanted something that was incredibly customizeable so it would account for any future iterations of changes. Just conceptualizing a system with so many moving parts was a challenge.  Once I got the basic structure down however, it was much easier to progress.</p>
			<h3>What I'm not proud of</h3>
			<p>In the end I was able to deliver above and beyond what they requested, but the complexity and ability to customize everything made for a software that had a steeper learning curve.</p>
			<ul class="nav nav-tabs" id="pricingTabs">
			  <li class="active"><a href="#controller" data-toggle="tab">Controller</a></li>
			  <li><a href="#pricingServices" data-toggle="tab">Service</a></li>
			</ul>

			<div class="tab-content" style="height:50%;">
				<div class="tab-pane active tab-container" id="controller">
					<pre>
'use strict';


angular.module('myApp.controllers', [])

.controller('AppCtrl', ['$window', '$scope','flashMessageService','$rootScope','AuthService','$location', '$cookies', 'SharedState',
	function($window, $scope,flashMessageService,$rootScope,AuthService,$location, $cookies,SharedState) {
  $scope.userAgent = navigator.userAgent;

	$rootScope.$watch('saveCheck',function( newValue, oldValue ) {
		if(newValue){
			$window.onbeforeunload = function(e) {
				return 'It looks like you may have unsaved changes, are you sure you want to leave the page?';
				};
			}
			else $window.onbeforeunload = false;
		}, true);

      $scope.site = {
            logo: "img/infocus-logo.png",
            footer: "Copyright 2016 InFocus Corporation"
        };
        	SharedState.initialize($scope, "uiSidebarLeft");
        			  $scope.notices = [];
  
		for (var j = 0; j < 10; j++) {
		$scope.notices.push({icon: 'envelope', message: 'Notice ' + (j + 1) });
		}

		$scope.deleteNotice = function(notice) {
		var index = $scope.notices.indexOf(notice);
		if (index > -1) {
		  $scope.notices.splice(index, 1);
		}
		};
	$scope.logout = function() {
	
	  AuthService.logout().then(
	    function() {

	      $location.path('/admin/login');
	      // flashMessageService.setMessage("Successfully logged out");
	      $scope.loggedInUser = '';
	      $cookies.remove('loggedInUser');
	    }, function(err) {
	    });
	};
    }
	])

.controller('AddEditPageCtrl', ['$scope', '$log', 'pagesFactory', '$stateParams', '$location', '$filter', 
	function($scope, $log, pagesFactory, $stateParams, $location, $filter){
	$scope.pageContent = {};
	$scope.pageContent._id = $stateParams.id;
	$scope.heading = "Add a New Page";

	if($scope.pageContent._id !== 0) {
		$scope.heading = "Update Page";
		pagesFactory.getAdminPageContent($scope.pageContent._id).then(
			function(response) {
				$scope.pageContent = response.data;
				$log.info($scope.pageContent);
			},
			function(err) {
				$log.error(err);
			});
	}
	$scope.tinymceOptions = {
	  height: 500,
	  theme: 'modern',
	  plugins: [
	    'advlist autolink lists link image charmap print preview hr anchor pagebreak',
	    'searchreplace wordcount visualblocks visualchars code fullscreen',
	    'insertdatetime media nonbreaking save table contextmenu directionality',
	    'emoticons template paste textcolor colorpicker textpattern imagetools importcss'
	  ],
	  toolbar1: 'insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image',
	  toolbar2: 'print preview media | forecolor backcolor emoticons',
	  image_advtab: true,
	  templates: [
	    { title: 'Test template 1', content: 'Test 1' },
	    { title: 'Test template 2', content: 'Test 2' }
	  ],
	  content_css: [
	    '/bower_components/html5-boilerplate/css/main.css',
	    '/bower_components/mobile-angular-ui/dist/css/mobile-angular-ui-hover.min.css',
	    '/bower_components/mobile-angular-ui/dist/css/mobile-angular-ui-base.min.css',
	    '/bower_components/mobile-angular-ui/dist/css/mobile-angular-ui-desktop.min.css',
	    '/css/app.css'
	  ]
    };
	$scope.updateURL=function(){
	  	$scope.pageContent.url=$filter('formatURL')($scope.pageContent.title);
	};
	$scope.savePage = function() {
		pagesFactory.savePage($scope.pageContent).then(
			function() {
				// flashMessageService.setMessage("Page Saved Successfully");
				$location.path('/admin/pages');
			},
			function() {
				$log.error('error saving data');
			}
		);
	};
	}])

.controller('PageCtrl',  [ '$scope','$cookies','pagesFactory', '$stateParams', '$sce', 
	function($scope,$cookies, pagesFactory, $stateParams,$sce) {
	var url = $stateParams.url;
	if(!url) url="home";
    pagesFactory.getPageContent(url).then(
      function(response) {
		$scope.pageContent = {};
		$scope.pageContent.title = response.data.title;
		$scope.userRoll = $cookies.get('userRoll');
		if($scope.userRoll == response.data.rollRequired || $scope.userRoll == 'admin')
		$scope.pageContent.content = $sce.trustAsHtml(response.data.content);
			else
			$scope.pageContent.content = $sce.trustAsHtml('You are not authorized to view this page');
      }, function() {
      });
	}])

.controller('AdminLoginCtrl', ['$scope', '$location', '$cookies', 'AuthService',
	function($scope, $location, $cookies, AuthService) {
		$scope.credentials = {
			username: '',
			password: '',
			roll: ''
		};
		$scope.login = function(credentials) {
			AuthService.login(credentials).then(
				function(res, err) {
					$cookies.loggedInUser = res.data.username;
					$cookies.userRoll = res.data.roll;
					$cookies.put('loggedInUser', res.data.username);
					$cookies.put('userRoll', res.data.roll);
					$location.path('/admin/pages');
				},
				function(err) {
				});
		};
	}
	])

.controller('AdminPagesCtrl', ['$scope', '$log', 'pagesFactory', 
	function($scope, $log, pagesFactory){
	pagesFactory.getPages().then(
		function(response) {
			$scope.allPages = response.data;
		},
		function(err) {
			$log.error(err);
		});

		$scope.deletePage = function(id) {
			pagesFactory.deletePage(id);
		};
	}
	])

.controller('PricingCtrl', ['$scope','$stateParams','$state', 'flashMessageService','$rootScope', '$http', 'productsFactory', 'hotRegisterer', '$filter', 'SharedState', 
	function($scope,$stateParams,$state,flashMessageService,$rootScope,$http,productsFactory,hotRegisterer,$filter,SharedState) {

	var viewData =[];
	var w = angular.element(window);
	var body = document.getElementsByClassName("app-content");
	var h = body[0].clientHeight;	
	$scope.hideColumns=[];
	$scope.ttValue=[];
	viewData["view"] = $stateParams.view;
	$scope.minSpareRows = 0;
	$scope.rowHeaders = false;
	$scope.db = [];
	$scope.dbUnfiltered = [];
	$scope.errorMessages=[];

	$scope.init = function(){
		$scope.setView($stateParams);
		$scope.getProducts($stateParams.view);
		$scope.month = new Date().getMonth()+2;
		$scope.year = new Date().getFullYear();
		};

	$scope.setView = function(view){
		for(var k in $scope.views){
			if($scope.views[k] && k == "accessories" && view.view != "accessories") $scope.reloadView = true;
			if(!$scope.views["accessories"] & view.view == "accessories") $scope.reloadView = true;
			}
		$state.go('pricing',{view:view.view},{notify:false, reload:false});
		if($scope.reloadView) $scope.getProducts(view.view);
		$scope.reloadView = false;
		$scope.currentView = view.view;
		productsFactory.getColumns(view).then(function(response) {
			$scope.views = response.data.views;
			var tmpColumns = response.data.columns;
			$scope.exColumns = response.data.exColumns;
			for(var i=0;i < tmpColumns.length;i++){
				if(tmpColumns[i]['data']!="part" && tmpColumns[i]['data']!="productGroup" ){tmpColumns[i]['renderer'] = $scope.defaultValueRenderer;}
				}
			for(var i=0;i < $scope.exColumns.length;i++){
				if($scope.exColumns[i]['data']!="part" && $scope.exColumns[i]['data']!="productGroup"){$scope.exColumns[i]['renderer'] = $scope.defaultValueRenderer;}
				}
			$scope.columns = tmpColumns;
			$scope.settings.columns = $scope.columns;
			$scope.hot.updateSettings($scope.settings);
			}, function(err) {});
		};

	$scope.getProducts = function(view){
		productsFactory.getProducts(view).then(function(response) {
			$scope.db = response.data;
			$scope.dbUnfiltered = response.data;
			$scope.rendered = true;
			}, function(err) {$log.error(err);});
		};

	$scope.saveView = function(view){
		if(view == 'all'){
			flashMessageService.setMessage("Cannot overwrite 'All' view","alert-error");
			return;
			}
		view = view ? view : "default";
		var pageData ={};
		pageData['view']=view;
		pageData['data']=$scope.columns;
		for(var i=0;i<$scope.columns.length;i++){
			$scope.columns[$scope.hot.manualColumnPositions[i]]['order']=i;
			}
		productsFactory.saveView(pageData).then(function(response) {
			flashMessageService.setMessage("View Saved");
		$state.go('pricing',{view:view},{notify:false, reload:false});
		$scope.currentView = view;
			}, function(err) {});
		};

	$scope.removeCol = function(col){
		for (var i = 0 ;i < $scope.hot.manualColumnPositions.length; i++) {
			if($scope.hot.manualColumnPositions[i]>$scope.hot.manualColumnPositions[col]) $scope.hot.manualColumnPositions[i]--;
			}
		col = $scope.hot.manualColumnPositions.splice(col,1)[0];
		$scope.exColumns.push($scope.columns.splice(col,1)[0]);
		$scope.hot.updateSettings($scope.settings);
		};

	$scope.renameCol = function(col){
		col = $scope.hot.manualColumnPositions[col];
		var response = prompt("New Column Header?",$scope.columns[col].title);
		if(response != null) $scope.columns[col].title = response;
		};

	$scope.cleanUp = function(){
		$scope.hot.renderCall = true;
		$scope.hot.render();
		for(var i=0;i<$scope.hideColumns.length;i++){
			$scope.exColumns.splice($scope.hideColumns[i],1);
			}
		$scope.hideColumns=[];
		};

	$scope.addCol = function(col){
		$scope.hideColumns.push(col);
		var spliced = $scope.exColumns[col];
		$scope.columns.splice(1,0,spliced);
		var tempSettings = $scope.settings;
		tempSettings.columns = $scope.columns;
		$scope.hot.updateSettings(tempSettings);
		};

	$scope.defaultValueRenderer = function(hotInstance, td, row, col, prop, value, cellProperties) {
		Handsontable.renderers.NumericRenderer.apply(this, arguments);
		var defaultValue = hotInstance.getDataAtRowProp(row,prop.replace("value","default"));
		var historyValue = hotInstance.getDataAtRowProp(row,prop.replace("value","history"));

		if(defaultValue != null && defaultValue != value && (prop != "demo.value" || value != 0)){
			td.style.fontWeight = 'bold';
			td.style.color = '#00217F';
			td.style.background = '#CBDDED';
			defaultValue = true;
			} else defaultValue = false;
		if(historyValue && historyValue != "" && historyValue != "0" && historyValue != null && historyValue != value && (prop != "demo.value" || value != 0)){
			td.style.fontWeight = 'bold';
			td.style.color = '#7E7F00';
			td.style.background = '#EDECCB';
			historyValue = true;
			} else historyValue = false;
		if(historyValue && defaultValue && historyValue != null && historyValue != "" && defaultValue != null){
			td.style.color = '#007F03';
			td.style.background = '#CCEDCB';
			}
		};

	$scope.$watch(function() { return $scope.inputFilter },function(){
		$scope.db = $filter('filter')($scope.dbUnfiltered,  $scope.inputFilter );
		if($scope.inputFilter == "") $scope.hot.updateSettings({manualRowMove: true});
			else $scope.hot.updateSettings({manualRowMove: false});
		})

	$scope.publishPricing = function(year,month){
		var pageData = {"year": year, "month": month};
		productsFactory.setHistory(pageData).then(function(response) {
			}, function(err) {});

		productsFactory.publishPricing(pageData).then(function(response) {
			}, function(err) {});

		//code for creating xml
		}

	$scope.mouseTrack = function(e){
		var tooltipSpan,	x,	y;
		tooltipSpan = document.getElementById('tooltip-span');
		x = e.clientX,
		y = e.clientY;
		tooltipSpan.style.top = (y-30) + 'px';
		tooltipSpan.style.left = (x+15) + 'px';
		};

	w.bind('resize', function () {
		var body = document.getElementsByClassName("app-content");
		var h = body[0].clientHeight;
		$scope.settings.height = h;
		$scope.hot.updateSettings($scope.settings);
		});

	$scope.settings = {
		height: h ,
		manualColumnMove: true,
		manualColumnResize: true,
		renderAllRows: true,
		renderAllColumns: true,
		viewportColumnRenderingOffset: 100,
		manualRowMove: true,
		colHeaders: true,
		rowHeaders: true,
		columnSorting: true,
		sortIndicator: true,
		filters: true,
		//columns: $scope.columns,
		onAfterInit: function() {$scope.hot = this;},
		onAfterChange: function (changes, source) {
			if(changes == null || source=="auto" || source=="external"){return;}
			changes.forEach(function(change){
				if(change[3] === change[2]){return;}
				if (source != 'loadData') {          
					var hot = $scope.hot;
					var dataSend = new Object;
					dataSend.part = hot.getDataAtRowProp(change[0],"part");
					if(change[1] != "part" && (dataSend.part == null || dataSend.part == '')) {
						flashMessageService.setMessage("Enter a part number first!","alert-danger");
						hot.setDataAtRowProp(change[0],change[1],change[2],"auto");
						}
					else if(hot.getDataAtRowProp(change[0],"productGroup") == null) 
					flashMessageService.setMessage("Will not show on any pricelist without a product group value!","alert-danger");
					if(change[1] == "part") {
						dataSend.part = change[2];
						dataSend.row = change[0];
						if(change[3]=='') {
						flashMessageService.setMessage("Cannot empty part number field!","alert-danger");
						hot.setDataAtRowProp(change[0],change[1],change[2],"auto");
							return;
						}
						}
					dataSend.data = new Object;
					dataSend.data[change[1]] = change[3];
					productsFactory.saveProduct(dataSend).then(function() {
						var defaultValue = hot.getDataAtRowProp(change[0],change[1].replace("value","default"));
						if(change[3] === '' && defaultValue != null)
						{hot.setDataAtRowProp(change[0],change[1],defaultValue,"loadData")}
						}, function() {
						});
					}
				});
			},
		onAfterColumnSort: function() {
			var newVal = $scope.hot.sortingEnabled && typeof $scope.hot.sortOrder !== 'undefined';
			if(newVal){
				$scope.hot.updateSettings({manualRowMove: false});
				if(!$scope.isSorted) flashMessageService.setMessage("Moving of rows is disabled while sorted");
				$scope.isSorted = true;
				}
				else{
					$scope.hot.updateSettings({manualRowMove: true});
					flashMessageService.setMessage("Moving of rows has been re-enabled","alert-success");
					$scope.isSorted = false;
					}
			},
		afterOnCellMouseOver: function(event, coords, td){
			var prop = $scope.hot.getCellMeta(coords.row, coords.col);
			prop = prop.prop;
			if(coords.col == -1) return;
			var coreField = prop.split(".");
			coreField = coreField[0];
			var tmpFieldVal = $scope.hot.getDataAtRowProp(coords.row, prop)
			var tmpDefaultVal = $scope.hot.getDataAtRowProp(coords.row, coreField+".default");
			var histVal = $scope.hot.getDataAtRowProp(coords.row, coreField+".history");
			if(prop.substr(-5) == "value" &&  (tmpDefaultVal != tmpFieldVal || (tmpFieldVal != histVal && histVal != null))){
				$scope.ttShow = false;
				if(tmpDefaultVal != tmpFieldVal && tmpDefaultVal != null){
					$scope.ttShow = true;
					$scope.ttValue.val = tmpDefaultVal;
					$scope.ttValue.compare =  eval(100-(Math.floor((tmpFieldVal/tmpDefaultVal)*100)));
					$scope.ttValue.compare =  $scope.ttValue.compare>0 ? " +" + $scope.ttValue.compare + "%" : " " + $scope.ttValue.compare + "%"; 
					}
					else $scope.ttValue=[];
				if(tmpFieldVal != histVal && histVal != null && histVal != 0){
					$scope.ttShow = true;
					if(isNaN(histVal)) $scope.ttValue.history = histVal;
						else{
							$scope.ttValue.history = "$"+histVal;
							$scope.ttValue.hcompare =  eval(100-(Math.floor((tmpFieldVal/histVal)*100)));
							$scope.ttValue.hcompare =  $scope.ttValue.hcompare>0 ? " +" + $scope.ttValue.hcompare + "%" : " " + $scope.ttValue.hcompare + "%"; 
							}
					}
					else $scope.ttValue.history = "";
				}
				else $scope.ttShow = false;
			},
		onBeforeRemoveRow: function(index,amount,rowsArray){
			var hot = $scope.hot;
			var dataSend = {};
			dataSend.data = [];
			for(var i=0;i < rowsArray.length;i++){dataSend.data.push(hot.getDataAtRowProp(rowsArray[i],"part"));}
			productsFactory.deleteProduct(dataSend).then(function() {
				flashMessageService.setMessage("Product(s) Removed");
				}, function() {});
			},
		onAfterRowMove: function(startRow,endRow){
			var dataSend = {};
			dataSend.data = [];
			dataSend.endRow = endRow+1;
			dataSend.startRow = startRow+1;
			for (var i = 0; i < $scope.hot.manualRowPositions.length; i++) {
				$scope.hot.manualRowPositions[i]
				dataSend.data.push({"part": $scope.hot.getDataAtRowProp(i,"part"), "rank": i});
			}
			productsFactory.moveRow(dataSend).then(function(response){

				}, function(err) {});

			},
		modifyColWidth: function(width, col){
			if($scope.columns[this.manualColumnPositions[col]].width != width && $scope.rendered){
				$scope.columns[this.manualColumnPositions[col]].width = width;
				} 
			},
		contextMenu: {
			callback: function (key, options) {
				if (key === 'about') {
					setTimeout(function () {
					// timeout is used to make sure the menu collapsed before alert is shown
					alert("This is a context menu with default and custom options mixed");
					}, 100);
					}
				if(key === 'Remove Column'){
					$scope.removeCol(options.start.col);
					}
				if(key === 'Rename Column'){
					$scope.renameCol(options.start.col);
					}
				},
			items: {
				"Rename Column": {
					name: 'Rename Column',
					disabled: function () {
						// if first row, disable this option
						return;
						}        
					},   				"Remove Column": {
					name: 'Remove Column',
					disabled: function () {
						// if first row, disable this option
						return $scope.hot.getSelected()[1] != $scope.hot.getSelected()[3]
						}        
					},        
				"hsep2": "---------",
				"row_above": {
					disabled: function () {
						// if first row, disable this option
						return;
						}
					},
				"row_below": {},
				"hsep1": "---------",
				"remove_row": {
					name: 'Remove row',
					disabled: function () {
						// if first row, disable this option
						return;
						}
					}

				}
			}
		};
	}])

.controller('TabsCtrl', ['$window','$scope', '$compile','$stateParams','$state', 'flashMessageService'
,'$rootScope', '$http', 'productsFactory', 'hotRegisterer', '$filter', 'SharedState', 
	function($window,$scope, $compile,$stateParams,$state,flashMessageService,$rootScope,$http,productsFactory,hotRegisterer,$filter,SharedState) {

	$scope.hideColumns=[];
	$scope.ttValue=[];
	var viewData =[];
	viewData["view"] = $stateParams.view;
	
	$scope.init = function(){
		$scope.setView($stateParams);
		productsFactory.getCategories($stateParams.view);
		}
		$scope.existCheck = function(newView){
			$scope.viewExist = false;
			Object.keys($scope.views).forEach(function(key,index) {
			    if(newView == $scope.views[key].name) $scope.viewExist = true;
			});
		}
	$scope.setView = function(view){
		$state.go('edittabs',{view:view.view},{notify:false, reload:false});
		if($scope.reloadView) $scope.getProducts(view.view);
		$scope.reloadView = false;
		view.view = view.view? view.view : 1;
		productsFactory.getTabColumns(view).then(function(response) {
			$scope.currentView = response.data.name;
			$scope.views = response.data.views;
			$scope.columns = response.data.columns;
			$scope.exColumns = response.data.exColumns;
			$scope.notesKey = response.data.notesKey;
			$scope.categorySpacers = response.data.categorySpacers;
			$scope.tabType = response.data.tabType;
			$scope.productHeaderOrder = response.data.productHeaderOrder;
			$scope.header = response.data.header;
			$scope.tabid = response.data.id;
			if(response.data.name == "all"){
				productsFactory.getCategories(view).then(function(response) {
					$scope.db = response.data;
					$scope.dbUnfiltered = response.data;
					$scope.rendered = true;
					}, function(err) {$log.error(err);});
				}
				else{
					var tmpDB = [];
					for (var i = 0; i < $scope.productHeaderOrder.length; i++) {
						tmpDB.push({"categoryName":$scope.productHeaderOrder[i]});
						}
					$scope.db = tmpDB;
					}
			var tmpColumns;
			tmpColumns = angular.copy($scope.columns)
			tmpColumns = formatHeaders(tmpColumns);
			tmpColumns.splice(0,0,{"title": "Category Name","data":"categoryName"})
			$scope.settings.columns = tmpColumns;
			$scope.hot.manualColumnPositions=[];
			$scope.hot.updateSettings($scope.settings);
			$scope.$parent.$parent.$root.saveCheck = false;
			$scope.hideColumns=[];
			}, function(err) {});
		}

	function formatHeaders(hotHeaders){
		var tmpColumns = hotHeaders;
		for(var i=0;i < tmpColumns.length;i++){
			tmpColumns[i].title = '
			< input type="text" title="'+tmpColumns[i].data.split(".")[0]+'" 
			class="hot-header form-control" ng-model="columns['+i+'].title" />';
			}
		return tmpColumns;
		}

	$scope.resetCategories = function(){
		var view="all";
			productsFactory.getCategories(view).then(function(response) {
				$scope.db = response.data;
				$scope.dbUnfiltered = response.data;
				$scope.rendered = true;
				}, function(err) {$log.error(err);});
		};


	$scope.newTab = function(view){
		$scope.tabid=0;
		$scope.saveTab(view);
		};

	$scope.deleteTab = function(view){
		productsFactory.deleteTab({"id": $scope.tabid}).then(function(response) {
			flashMessageService.setMessage("Tab Deleted");
			$scope.setView({'view':1});
			}, function(err) {});
		};

	$scope.$watch('columns',function( newValue, oldValue ) {
		if(typeof oldValue != "undefined" && newValue!=oldValue)
		{$scope.$parent.$parent.$root.saveCheck = true;}
		}, true);
	$scope.$watch('notesKey',function( newValue, oldValue ) {
		if(typeof oldValue != "undefined" && newValue!=oldValue)
		{$scope.$parent.$parent.$root.saveCheck = true;}
		}, true);
	$scope.$watch('notesKey',function( newValue, oldValue ) {
		if(typeof oldValue != "undefined" && newValue!=oldValue)
		{$scope.$parent.$parent.$root.saveCheck = true;}
		}, true);
	$scope.$watch('categorySpacers',function( newValue, oldValue ) {
		if(typeof oldValue != "undefined" && newValue!=oldValue)
		{$scope.$parent.$parent.$root.saveCheck = true;}
		}, true);
	$scope.$watch('header',function( newValue, oldValue ) {
		if(typeof oldValue != "undefined" && newValue!=oldValue)
		{$scope.$parent.$parent.$root.saveCheck = true;}
		}, true);

	$scope.saveTab = function(view){
		var columnSort=[];
		for(var i=1;i<$scope.hot.manualColumnPositions.length;i++){
			columnSort.push($scope.columns[$scope.hot.manualColumnPositions[i]-1]);
			}
		var data = $scope.hot.getData();
		var productHeaderOrder = [];
		for(var i=0;i < data.length;i++){
			productHeaderOrder.push(data[i][0]);
			}
		  var newArray = new Array();
		  for (var i = 0; i < columnSort.length; i++) {
		    if (columnSort[i]) {
		      newArray.push(columnSort[i]);
		    }
		  }
		  columnSort = newArray;
		$scope.notesKey = $scope.notesKey ? 1 : 0;
		$scope.categorySpacers = $scope.categorySpacers ? 1 : 0;
		data = {};
		data['id'] = $scope.tabid;
		data['productHeaderOrder'] = productHeaderOrder;
		data['columns'] = columnSort;
		data['name'] = view;
		data['notesKey'] = $scope.notesKey;
		data['categorySpacers'] = $scope.categorySpacers;
		data['tabType'] = $scope.tabType;
		data['header'] = $scope.header;
	    productsFactory.saveTab(data).then(function(response) {
	    	flashMessageService.setMessage("Tab Saved");
			//$scope.setView({'view':response.data});
			$scope.$parent.$parent.$root.saveCheck = false;

		    }, function(err) {});
		};

	$scope.removeCol = function(col){
		for (var i = 0 ;i < $scope.hot.manualColumnPositions.length; i++) {
			if($scope.hot.manualColumnPositions[i]>$scope.hot.manualColumnPositions[col]) $scope.hot.manualColumnPositions[i]--;
		}
		col = $scope.hot.manualColumnPositions.splice(col,1)[0];
		$scope.exColumns.push($scope.columns.splice(col-1,1)[0]);
		var tmpColumns;
		tmpColumns = angular.copy($scope.columns)
		tmpColumns = formatHeaders(tmpColumns);
		tmpColumns.splice(0,0,{"title": "Category Name","data":"categoryName"})
		$scope.settings.columns = tmpColumns;
		$scope.hot.updateSettings($scope.settings);
		};

	$scope.cleanUp = function(){
		$scope.hot.renderCall = true;
		$scope.hot.render();
		for(var i=0;i<$scope.hideColumns.length;i++){$scope.exColumns.splice($scope.hideColumns[i],1);}
		$scope.hideColumns=[];
		}

	$scope.addCol = function(col){
		$scope.hideColumns.push(col);

		for (var i = 1 ;i < $scope.hot.manualColumnPositions.length; i++) {
			$scope.hot.manualColumnPositions[i]++;
		}
		$scope.hot.manualColumnPositions.splice(1,0,1);
		var spliced = $scope.exColumns[col];
		$scope.columns.splice(0,0,spliced);
		var tmpColumns;
		tmpColumns = angular.copy($scope.columns)
		tmpColumns = formatHeaders(tmpColumns);
		tmpColumns.splice(0,0,{"title": "Category Name","data":"categoryName"})
		$scope.settings.columns = tmpColumns;
		$scope.hot.updateSettings($scope.settings);

		};


	$scope.minSpareRows = 0;
	$scope.rowHeaders = false;
	$scope.db = [];
	$scope.dbUnfiltered = [];

	$scope.errorMessages=[];

	var w = angular.element($window);
	w.bind('resize', function () {
		var body = document.getElementsByClassName("app-content");
		var h = body[0].clientHeight;
		$scope.settings.height = h;
		$scope.hot.updateSettings($scope.settings);
		});
	var body = document.getElementsByClassName("app-content");
	var h = body[0].clientHeight;
	$scope.settings = {
		height: h ,
		manualColumnMove: true,
		manualRowMove: true,
		colHeaders: true,
		rowHeaders: true,
		afterOnCellMouseDown : function(sender, e){
			if (e.row === -1) this.getInstance().deselectCell();
			},
		onAfterInit: function() {
			$scope.hot = this;
			this.manualColumnMovePlugin = this.getPlugin('manualColumnMove');
			$scope.$parent.$parent.$root.saveCheck = false;
			},
		onAfterColumnMove: function(){$scope.$parent.$parent.$root.saveCheck = true;},
	    onAfterRender: function(){
			var hotHeaders = document.getElementsByClassName('hot-header');
			for(var i=0;i < hotHeaders.length;i++){$compile(hotHeaders[i])($scope);}    
			},
	    contextMenu: {
			callback: function (key, options) {
				if (key === 'about') {
					setTimeout(function () {
					// timeout is used to make sure the menu collapsed before alert is shown
					alert("This is a context menu with default and custom options mixed");
					}, 100);
					}
				if(key === 'Remove Column')$scope.removeCol(options.start.col);
				},
			items: {
				"undo":{},
				"redo":{},
				"Remove Column": {name: 'Remove Column',
					disabled: function () {
						// if first row, disable this option
						return $scope.hot.getSelected()[1] != $scope.hot.getSelected()[3]
						}        
					},        
				"hsep2": "---------",
				"row_above": {
					disabled: function () {
						// if first row, disable this option
						return;
						}
					},
				"row_below": {},
				"hsep1": "---------",
				"remove_row": {
					name: 'Remove row',
					disabled: function () {
						// if first row, disable this option
						return;
						}
					}

				}    
			}
		};
	}])

.controller('SheetsCtrl', ['$window', '$scope', '$compile','$stateParams','$state', 'flashMessageService','$rootScope', '$http', 'productsFactory', 'hotRegisterer', '$filter', 'SharedState', 
	function($window, $scope, $compile,$stateParams,$state,flashMessageService,$rootScope,$http,productsFactory,hotRegisterer,$filter,SharedState) {

    productsFactory.getSheets().then(function(response) {
    	$scope.sheets = response.data;
	    }, function(err) {});

    productsFactory.getTabs().then(function(response) {
    	$scope.tabs = response.data;
	    }, function(err) {});

	$scope.$watch('sheets',function( newValue, oldValue ) {
		if(typeof oldValue != "undefined"){$scope.$parent.$parent.$root.saveCheck = true;}
		}, true);
    
    $scope.deleteSheet = function(sheetId){$scope.sheets.splice(sheetId,1);};

	$scope.previewPricing = function(sheet){
		var currentTime = new Date()
		var pageData = {"year": currentTime.getFullYear(), "month": currentTime.getMonth()+1, "sheet": sheet};
		productsFactory.previewPricing(pageData).then(function(response) {
		    // var blob = new Blob([response.data], {type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});
		    // var objectUrl = URL.createObjectURL(blob);
		    window.open("/sheets/tmp_sheet.xlsx");			
			}, function(err) {});
		}


    $scope.saveSheets = function(){
	    productsFactory.setSheets($scope.sheets).then(function(response) {
    	flashMessageService.setMessage("Sheets Saved");    	
		$scope.$parent.$parent.$root.saveCheck = false;
	    }, function(err) {});    	
	    }

		}])

.controller('AssignCtrl', ['$window','$scope', 'flashMessageService', 'productsFactory', '$filter', 'SharedState', 
	function($window, $scope, flashMessageService,productsFactory,$filter,SharedState) {

    productsFactory.getTabAssignments().then(function(response) {
    	$scope.tabAssignments = response.data;
	    }, function(err) {});

	$scope.$watch('tabAssignments',function( newValue, oldValue ) {
		if(typeof oldValue != "undefined"){$scope.$parent.$parent.$root.saveCheck = true;}
		}, true);

    $scope.saveAssignments = function(){
    	productsFactory.setTabAssignments($scope.tabAssignments).then(function(response){
    	flashMessageService.setMessage("Assignments Saved");    	
	    $scope.$parent.$parent.$root.saveCheck = false;
	    }, function(err) {});
	    };

	$scope.setAll = function(index,setting,type){
		if(type=='row'){
			$scope.tabAssignments[index].tab_ID = setting;
			$scope.tabAssignments[index].tab_PS = setting;
			$scope.tabAssignments[index].tab_AC = setting;
			$scope.tabAssignments[index].tab_EV = setting;
			$scope.tabAssignments[index].tab_C1 = setting;
			$scope.tabAssignments[index].tab_C2 = setting;
			}
			else{
				for (var i = 0; i < $scope.tabAssignments.length; i++) {
					$scope.tabAssignments[i][index]=setting;
					}
				}
		};

		}])

.controller('RulesCtrl', ['$window','$scope', 'flashMessageService', 'productsFactory', '$filter', 'SharedState', 
	function($window, $scope, flashMessageService,productsFactory,$filter,SharedState) {

    productsFactory.getRules().then(function(response) {
    	$scope.rules = response.data;
	    }, function(err) {});

    productsFactory.getRuleLists().then(function(response) {
    	$scope.colList = response.data.colList;
    	$scope.groupList = response.data.groupList;
	    }, function(err) {});

	$scope.$watch('rules',function( newValue, oldValue ) {
		if(typeof oldValue != "undefined"){$scope.$parent.$parent.$root.saveCheck = true;}
		}, true);

    $scope.saveRules = function(){
    	productsFactory.setRules($scope.rules).then(function(response){
    	flashMessageService.setMessage("Rules Saved");    	
	    $scope.$parent.$parent.$root.saveCheck = false;
	    }, function(err) {});
	    }

    $scope.deleteRule = function(ruleId){$scope.rules.splice(ruleId,1);};

		}])

.controller('NotesCtrl', ['$window','$scope', 'flashMessageService', 'productsFactory', '$filter', 'SharedState', 
	function($window, $scope, flashMessageService,productsFactory,$filter,SharedState) {

    productsFactory.getNotes().then(function(response) {
    	$scope.notes = response.data;
	    }, function(err) {});

	$scope.$watch('notes',function( newValue, oldValue ) {
		if(typeof oldValue != "undefined"){$scope.$parent.$parent.$root.saveCheck = true;}
		}, true);

    $scope.saveNotes = function(){
    	productsFactory.setNotes($scope.notes).then(function(response){
    	flashMessageService.setMessage("Notes Saved");    	
	    $scope.$parent.$parent.$root.saveCheck = false;
	    }, function(err) {});
	    }

    $scope.deleteNote = function(noteId){$scope.notes.splice(noteId,1);};

		}])

.controller('KitsCtrl', ['$scope', 'flashMessageService', 'productsFactory', '$filter', 'SharedState', 
	function($scope, flashMessageService,productsFactory,$filter,SharedState, hotRegisterer) {

    productsFactory.getKits().then(function(response) {
    	$scope.kits = response.data;
    	$scope.$parent.$parent.$root.saveCheck = false;

    }, function(err) {});

	$scope.$watch('kits',function( newValue, oldValue ) {
		if(typeof oldValue != "undefined"){$scope.$parent.$parent.$root.saveCheck = true;}
		}, true);

    productsFactory.getParts().then(function(response) {
    	$scope.parts = response.data;
    }, function(err) {});

    $scope.deleteKit = function(kitsId){$scope.kits.splice(kitsId,1);};
    $scope.saveKits = function(){
	    productsFactory.setKits($scope.kits).then(function(response) {
    	flashMessageService.setMessage("Kits Saved");    
    	$scope.$parent.$parent.$root.saveCheck = false;	
	    },function(err) {});    	
	    }

	}])

					</pre>
				</div>
				<div class="tab-pane tab-container" id="pricingServices">
					<pre>
'use strict';

angular.module('myApp.services', [])

.factory('pagesFactory', ['$http',
	function($http) {
		return{
			getPages: function() {
				return $http.get('/api/pages');
			},

			savePage: function(pageData) {
				var id = pageData._id;

				if (id === 0) {
					return $http.post('/api/pages/add', pageData);
				} else {
					return $http.post('/api/pages/update', pageData);
				}
			},

			deletePage: function(id) {
				return $http.get('/api/pages/delete' + id);
			},

			getAdminPageContent: function(id) {
				return $http.get('/api/pages/admin-details/' + id);
			},
       		getPageContent: function(url) {
        		return $http.get('/index.php?page=' + url);
      		},
			getProducts: function() {
				return $http.get('/api/pages');
			},

      };
	}
])

.factory('productsFactory', ['$http',
	function($http) {
		return{
			getProducts: function(view) {
				return $http.get('/pricingAPI.php?action=get&view='+view);
			},

			getCategories: function(view) {
				return $http.get('/pricingAPI.php?action=getCategories&view='+view);
			},

			saveProduct: function(pageData) {
					return $http.post('/pricingAPI.php?action=update', pageData);
			},

			addProduct: function(pageData) {
					return $http.post('/pricingAPI.php?action=add', pageData);
			},

			moveRow: function(pageData) {
				return $http.post('/pricingAPI.php?action=reorder', pageData);
			},

			getColumns: function(pageData) {
				return $http.post('/pricingAPI.php?action=getColumns', pageData);
			},

			getTabColumns: function(pageData) {
				return $http.post('/pricingAPI.php?action=getTabColumns', pageData);
			},

			saveView: function(pageData) {
				return $http.post('/pricingAPI.php?action=saveView', pageData);
			},

			saveTab: function(pageData) {
				return $http.post('/pricingAPI.php?action=saveTab', pageData);
			},

			setColumns: function(pageData) {
				return $http.post('/pricingAPI.php?action=setColumns', pageData);
			},

			deleteView: function(pageData) {
				return $http.post('/pricingAPI.php?action=deleteView', pageData);
			},

			deleteTab: function(pageData) {
				return $http.post('/pricingAPI.php?action=deleteTab', pageData);
			},

			getTabs: function() {
				return $http.get('/pricingAPI.php?action=getTabs');
			},

			getSheets: function() {
				return $http.get('/pricingAPI.php?action=getSheets');
			},
			setSheets: function(pageData) {
				return $http.post('/pricingAPI.php?action=setSheets', pageData);
			},
			getParts: function() {
				return $http.get('/pricingAPI.php?action=getParts');
			},

			getKits: function() {
				return $http.get('/pricingAPI.php?action=getKits');
			},
			setKits: function(pageData) {
				return $http.post('/pricingAPI.php?action=setKits', pageData);
			},
			getTabAssignments: function() {
				return $http.get('/pricingAPI.php?action=getTabAssignments');
			},
			setTabAssignments: function(pageData) {
				return $http.post('/pricingAPI.php?action=setTabAssignments', pageData);
			},
			getRules: function() {
				return $http.get('/pricingAPI.php?action=getRules');
			},
			getRuleLists: function() {
				return $http.get('/pricingAPI.php?action=getRuleLists');
			},
			setRules: function(pageData) {
				return $http.post('/pricingAPI.php?action=setRules', pageData);
			},
			getNotes: function() {
				return $http.get('/pricingAPI.php?action=getNotes');
			},
			setNotes: function(pageData) {
				return $http.post('/pricingAPI.php?action=setNotes', pageData);
			},
			setHistory: function(pageData) {
				return $http.post('/pricingAPI.php?action=setHistory', pageData);
			},
			publishPricing: function(pageData) {
				return $http.post('/pricingAPI.php?action=publishPricing', pageData);
			},
			previewPricing: function(pageData) {
				return $http.post('/pricingAPI.php?action=previewPricing', pageData,{"responseType": 'arraybuffer'});
			},
			deleteProduct: function(pageData) {
				return $http.post('/pricingAPI.php?action=deleteProduct', pageData);
			},

			getAdminProductContent: function(id) {
				return $http.get('/api/products/admin-details/' + id);
			},
       		getProductContent: function(url) {
        		return $http.get('/api/products/details/' + url);
      		},
      };
	}
])

.factory('AuthService', ['$http', function($http) {
	return {
		login: function(credentials) {
			return $http.post('/api/login', credentials);
		},
		logout: function(){
			return $http.get('/api/logout');
		}
	};
}])

.factory('flashMessageService', ['$rootScope',function($rootScope) {
  var message = [];
  return {
    getMessage: function() {
      	return message;
    },
    setMessage: function(newMessage,alertType) {
      	message.message = newMessage;
      	message.alert = alertType;
    	$rootScope.$broadcast('NEW_MESSAGE');
	}
  };
}])

.factory('myHttpInterceptor', ['$q', '$location', function($q, $location){
	return {
		response: function(response) {
			return response;
		},
		responseError: function(response) {
			if (response.status === 401) {
				$location.path('/admin/login');
				return $q.reject(response);
			}
			return $q.reject(response);
		}
	};
}])

					</pre>
				</div>
			</div>
		</div>
		<div id="feature9" class="features off">
				<h1>InFocus.com US and Global Sites</h1>
				<h4 class="text-center">
					<div class="col-xs-4">
						<strong>Language:</strong> PHP, Javascript
					</div>
					<div class="col-xs-4">
						<strong>Library:</strong> None
					</div>
					<div class="col-xs-4">
						<strong>Github:</strong> <a href="https://github.com/InFocus-Corporation/InFocus.com">Link</a>
					</div>
				</h4>
				<div>
					The German version of this site can still be viewed at <a href="www.infocus.de">www.infocus.de</a> (at the time of writing this). The story behind this is it was supposed to be a temporary site.  The whole thing was developed very rapidly (2 months), and the focus was on easy maintainability so the marketing team could focus most of their attention on the development of the NEW new site. That "temporary site" ended up being used for 6 years (and counting for the German site).  So something that was tossed together very quickly, and included a custom CMS, held up surprisingly well given the number of changes and customization that were seen in that 6 year period.
				</div>
				<h3>What I'm not proud of</h3>
				<p>Given that this was my very first project of this scale, and I had done nothing even close to its scope before, there was a lot I'm not particularly proud of.  By the end of the 6 years it had so much "duct-tape" for all the un-intended customizations.  However for what it was meant to be, a quickly built site with a custom CMS, it served very well. </p>
				<h3>Code</h3>
				<p>Ok, I lied, no code here.  I was going to find a piece of good code to include on this page, but the site is fairly massive, and there isn't a lot that stands out as "impressive" work.  Most of the time I was on a "this needs to be done yesterday" time frame so I rarely had time to do things properly.  I learned to code quickly, but made plenty of shortcuts.  If you do want to see the code you are welcome to peruse the Github repository.</p>
		</div>
		<div id="feature10" class="features off">
			<h2>Upgrade GameMaster.Pro to ReactJS</h2>
			<div>
				<span>The first version of GameMaster.Pro was very functional, but it had its share of "hacks", and hiccups.  Now that I have a better idea of what the end product will be I want to re-code the system in ReactJS.  React (likely with redux and react router) will give a more finely tuned system, and I like the component management it allows for.</span>

				<h4>Task List</h4>
				<ul>
					<li>
						Break-down the site into components and sub-components
					</li>
					<li>
						Re-write ambient noise controller
					</li>
					<li>
						Write timeline plugin that will allow for custom year/month length
					</li>
					<li>
						Integrate Character creator tool (partnered with Alex Warnes)
					</li>
				</ul>
			</div>

			<h2>Modern/Post apocalyptic game interface</h2>
			<div>
				<span>This would be another system to enhance tabletop roleplaying.  It would be interesting and fun in any post electronics age game, to have a reseach interface that the GM could plug campaign details into.  The players could then use search terms or navigation to try to dig up these details.  Rather than a GM just giving them a piece of paper or reading them what they find.  This would provide a little more tactile experience and provide more things for the players to interact over</span>
				<h4>Task List</h4>
				<ul>
					<li>
						Design front end interface(s).
					</li>
					<li>
						Easy data entry for information the PC's can find.
					</li>
					<li>
						Some type of "invalid" or "not-useful" results other than just "nothing found"
					</li>
					<li>
						Possible Additions
						<ul>
							<li>
								Hacking type mini-game
							</li>
							<li>
								System breaking mid search
							</li>
							<li>
								Front end GUI customization
							</li>
						</ul>
					</li>
				</ul>
			</div>

		</div>
	</div>
</div>

<div class="page">
	<div class="page-container">
		<div class="header">
			<h1>Hobbies</h1>
		</div>
		<div class="row">
			<div class="col-xs-3 text-center">
				<img class="img-responsive md-3" src="/img/hobby-computergames.png">
				<strong>Computer Games</strong>
			</div>
			<div class="col-xs-3 text-center">
				<img class="img-responsive" src="/img/hobby-boardgames.png">
				<strong>Board Games</strong>
			</div>
			<div class="col-xs-3 text-center">
				<img class="img-responsive" src="/img/hobby-books.png">
				<strong>Reading Fiction</strong>
			</div>
		</div>
		<div class="row">
			<div class="col-xs-3 text-center">
				<img class="img-responsive" src="/img/hobby-dogs.png">
				<strong>Dogs</strong>
			</div>
			<div class="col-xs-3 text-center">
				<img class="img-responsive" src="/img/hobby-movies.png">
				<strong>Movies</strong>
			</div>
			<div class="col-xs-3 text-center">
				<img class="img-responsive" src="/img/hobby-music.png">
				<strong>Music</strong>
			</div>
		</div>
		<div class="row">
			<div class="col-xs-3 text-center">
				<img class="img-responsive" src="/img/hobby-piano.png">
				<strong>Playing Piano</strong>
			</div>
			<div class="col-xs-3 text-center">
				<img class="img-responsive" src="/img/hobby-puzzles.png">
				<strong>Puzzles and Brain Teasers</strong>
			</div>
			<div class="col-xs-3 text-center">
				<img class="img-responsive" src="/img/hobby-science.png">
				<strong>Keeping up with Latest Science</strong>
			</div>
		</div>
	</div>
</div>

<div class="page">
	<div class="page-container">
		<div class="header">
			<h1>Family</h1>
		</div>
		<span>I adore my family, and spend every spare minute with them.  My wife and I will celebrate our 16th anniversary this year, and our daughter will turn 2 in December.</span>
		<img usemap="#image-maps-2017-07-16-165925" height="768" width="1024" class="img-responsive" src="/img/collage-2017-07-16.jpg" >

		<map name="image-maps-2017-07-16-165925" id="ImageMapsCom-image-maps-2017-07-16-165925">
			<area  alt="Peekaboo" class="img-modal" title="Peekaboo" src="/img/IMG_0930.jpg" shape="rect" coords="12,275,220,536"/>
			<area  alt="Geek Girl" class="img-modal" title="Geek Girl" src="/img/IMG_0035.jpg" shape="rect" coords="432,240,637,492"/>
			<area  alt="Peekaboo" class="img-modal" title="Peekaboo" src="/img/IMG_0930.jpg" shape="rect" coords="12,275,220,536"/>
			<area  alt="At Lego Exibit" class="img-modal" title="At Lego Exibit" src="/img/IMG_3044.jpg" shape="rect" coords="411,492,668,746"/>
			<area  alt="Snuggly Dogs" class="img-modal" title="Snuggly Dogs" src="/img/dog2.jpg" shape="poly" coords="405,1,318,58,319,272,386,321,434,291,434,242,506,240,576,190,447,1"/>
			<area  alt="Hair Bandana" class="img-modal" title="Camille Hair Bandana" src="/img/IMG_5011.jpg" shape="poly" coords="471,11,474,39,577,189,508,240,638,241,636,264,674,267,712,252,707,246,729,86,729,13"/>
			<area  alt="Getting Sleepy" class="img-modal" title="Getting Sleepy" src="/img/IMG_4859.jpg" shape="poly" coords="744,0,707,247,726,248,770,234,778,261,960,287,996,36"/>
			<area  alt="Daddy & Daughter" class="img-modal" title="Daddy & Daughter" src="/img/IMG_3189.jpg" shape="poly" coords="61,36,62,273,220,273,219,290,317,290,317,37"/>
			<area  alt="Squish-face" class="img-modal" title="Squish-face" src="/img/IMG_3719.jpg" shape="poly" coords="219,335,250,291,318,291,318,280,432,352,430,488,414,492,412,516,382,562,220,456"/>
			<area  alt="Proper Dog" class="img-modal" title="Proper Dog" src="/img/IMG_2396.JPG" shape="poly" coords="637,472.00001525878906,645,492.00001525878906,667,492.00001525878906,667,537.0000152587891,850,477.00001525878906,770,233.00001525878906,637,278.00001525878906"/>
			<area  alt="New Stroller" class="img-modal" title="New Stroller" src="/img/IMG_4834.jpg" shape="poly" coords="777,260.00001525878906,957,286.00001525878906,966,237.00001525878906,988,237.00001525878906,987,498.0000305175781,790,497.0000305175781,848,475.0000305175781"/>
			<area  alt="Cockroach Dog" class="img-modal" title="Cockroach Dog" src="/img/realpeople6.jpg" shape="poly" coords="136.00000023841858,536.0000305175781,218.00000023841858,536.0000305175781,219.00000023841858,509.0000305175781,276.0000002384186,492.0000305175781,362.0000002384186,550.0000305175781,413.0000002384186,708.0000305175781,412.0000002384186,714.0000305175781,249.00000023841858,767.0000305175781,162.00000023841858,766.0000305175781,95.00000023841858,549.0000305175781"/>
			<area  alt="Giggly" class="img-modal" title="Giggly" src="/img/IMG_4186.jpg" shape="poly" coords="705.0000002384186,524.0000305175781,780.0000002384186,499.0000305175781,868.0000002384186,500.0000305175781,968.0000002384186,518.0000305175781,920.0000002384186,768.0000305175781,908.0000002384186,767.0000305175781,670.0000002384186,722.0000305175781"/>
		</map>
	</div>
</div>

<div class="cover">
	<div class="page-container">
		<div class="header">
			<h1>Let's get to work!</h1>
		</div>
		<p>
			Thank you for stopping by my profile and online resume.  I hope it caught your eye.
		</p>
		<h4>Contact me</h4>
		<ul>
			<li>
				<strong>email: </strong><a href="mailto:Boggimedes@gmail.com">Boggimedes@gmail.com</a>
			</li>
			<li>
				<strong>phone: </strong>503-731-7167
			</li>
			<li>
				<strong>Linked In:</strong><a href="https://www.linkedin.com/in/daniel-boggs-b980b016/">https://www.linkedin.com/in/daniel-boggs-b980b016/</a>
			</li>
			<li>
				<strong>Github: </strong><a href="https://github.com/Boggimedes">https://github.com/Boggimedes</a>
			</li>
			<li>
				<strong>Roundpeg: </strong><a href="https://app.roundpegg.com/profile/9e5wygy76t ">https://app.roundpegg.com/profile/9e5wygy76t</a>
			</li>
		</ul>
<table class="table">
		<tbody>
		<tr class="pri">
			<td class="cbox bg-pri-3" rel="pri-3" style="background-color: rgb(255, 156, 65);"></td>
			<td class="cbox bg-pri-0" rel="pri-0" rowspan="2" style="background-color: rgb(255, 122, 0);"></td>
			<td class="cbox bg-pri-1" rel="pri-1" style="background-color: rgb(193, 117, 47);"></td>
		</tr>
		<tr class="pri">
			<td class="cbox bg-pri-4" rel="pri-4" style="background-color: rgb(255, 183, 116);"></td>
			<td class="cbox bg-pri-2" rel="pri-2" style="background-color: rgb(168, 81, 0);"></td>
		</tr>
		<tr class="sec sec1">
			<td class="cbox bg-sec1-1" rel="sec1-1" style="background-color: rgb(255, 156, 65);"></td>
			<td class="cbox bg-sec1-0" rel="sec1-0" rowspan="2" style="background-color: rgb(255, 156, 65);"></td>
			<td class="cbox bg-sec1-3" rel="sec1-3" style="background-color: rgb(255, 156, 65);"></td>
		</tr>
		<tr class="sec sec1">
			<td class="cbox bg-sec1-2" rel="sec1-2" style="background-color: rgb(255, 156, 65);"></td>
			<td class="cbox bg-sec1-4" rel="sec1-4" style="background-color: rgb(255, 156, 65);"></td>
		</tr>
		<tr class="sec sec2">
			<td class="cbox bg-sec2-1" rel="sec2-1" style="background-color: rgb(255, 183, 116);"></td>
			<td class="cbox bg-sec2-0" rel="sec2-0" rowspan="2" style="background-color: rgb(255, 183, 116);"></td>
			<td class="cbox bg-sec2-3" rel="sec2-3" style="background-color: rgb(255, 183, 116);"></td>
		</tr>
		<tr class="sec sec2">
			<td class="cbox bg-sec2-2" rel="sec2-2" style="background-color: rgb(255, 183, 116);"></td>
			<td class="cbox bg-sec2-4" rel="sec2-4" style="background-color: rgb(255, 183, 116);"></td>
		</tr>
		<tr class="compl">
			<td class="cbox bg-compl-1" rel="compl-1" style="background-color: rgb(44, 165, 182);"></td>
			<td class="cbox bg-compl-0" rel="compl-0" rowspan="2" style="background-color: rgb(0, 211, 241);"></td>
			<td class="cbox bg-compl-3" rel="compl-3" style="background-color: rgb(63, 225, 248);"></td>
		</tr>
		<tr class="compl">
			<td class="cbox bg-compl-2" rel="compl-2" style="background-color: rgb(0, 139, 159);"></td>
			<td class="cbox bg-compl-4" rel="compl-4" style="background-color: rgb(113, 232, 248);"></td>
		</tr>

		</tbody></table>
	</div>
</div>
